<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>ENGLISH WITH AI BAYAN ‚Äì Advanced</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <style>
    :root{
      --main:#ff6f00;          /* –Ω–∞—Å—ã—â–µ–Ω–Ω—ã–π –æ—Ä–∞–Ω–∂–µ–≤—ã–π */
      --main-dark:#e65100;
      --soft:#ff8f00;
      --gold:#ffd54f;
      --bg:#fff9f0;
      --topicColor:#ff6f00;
    }

    *{
      box-sizing:border-box;
      margin:0;
      padding:0;
      font-family:system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",sans-serif;
    }

    body{
      background:var(--bg);
      color:#3a2b1f;
    }

    header{
      background:linear-gradient(90deg,var(--main-dark),var(--main));
      color:#fff;
      padding:10px 24px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      box-shadow:0 2px 6px rgba(0,0,0,.25);
    }

    .brand{
      display:flex;
      align-items:center;
      gap:10px;
    }
    .logo-img{
      width:52px;
      height:52px;
      border-radius:50%;
      border:3px solid var(--gold);
      object-fit:cover;
      background:#fff;
    }
    .brand-text h1{
      font-size:18px;
      letter-spacing:.05em;
    }
    .brand-text span{
      font-size:12px;
      opacity:.9;
    }
    .top-info{
      font-size:13px;
      text-align:right;
    }
    .top-info strong{color:var(--gold);}

    main{
      padding:16px;
      max-width:1300px;
      margin:0 auto;
    }

    .card{
      background:#fff;
      border-radius:14px;
      box-shadow:0 4px 14px rgba(0,0,0,.1);
      padding:20px;
    }

    .hidden{display:none !important;}

    .section-title{
      font-size:18px;
      margin-bottom:10px;
      font-weight:600;
    }
    .muted{
      color:#6b5f55;
      font-size:12px;
    }

    .field-label{
      font-size:14px;
      margin-bottom:4px;
    }
    .text-input{
      width:100%;
      padding:10px 12px;
      border-radius:10px;
      border:1px solid #d6cec7;
      margin-bottom:14px;
      font-size:14px;
      background:#fffdf8;
    }
    .text-input:focus{
      outline:none;
      border-color:var(--soft);
      box-shadow:0 0 0 2px rgba(255,143,0,.25);
    }

    .btn{
      border:none;
      border-radius:10px;
      padding:9px 16px;
      font-size:14px;
      font-weight:600;
      cursor:pointer;
      display:inline-flex;
      align-items:center;
      justify-content:center;
      gap:6px;
    }
    .btn-primary{
      background:var(--main);
      color:#fff;
    }
    .btn-primary:hover{background:var(--main-dark);}
    .btn-ghost{
      background:#fff3e0;
      color:var(--main-dark);
    }
    .btn-ghost:hover{background:#ffe0b2;}

    .error{
      margin-top:10px;
      color:#b00020;
      font-size:13px;
    }

    #loginScreen{
      max-width:520px;
      margin:40px auto;
    }

    #mainMenuScreen{
      display:grid;
      grid-template-columns:2fr 1.2fr;
      gap:16px;
    }
    @media(max-width:960px){
      #mainMenuScreen{
        grid-template-columns:1fr;
      }
    }

    .top-row{
      display:flex;
      justify-content:space-between;
      align-items:center;
      flex-wrap:wrap;
      gap:8px;
      margin-bottom:12px;
    }

    .stars-badge{
      display:inline-flex;
      align-items:center;
      gap:4px;
      padding:4px 8px;
      border-radius:999px;
      background:#fff8e1;
      border:1px solid #ffecb3;
      font-size:12px;
    }
    .star-icon{color:#ffa000;}

    .topics-grid{
      display:grid;
      grid-template-columns:1fr 1fr;
      gap:10px;
    }
    @media(max-width:700px){
      .topics-grid{grid-template-columns:1fr;}
    }

    .topic-card{
      border-radius:12px;
      border:1px solid #ffe0b2;
      padding:10px 12px;
      background:#fffdf7;
      cursor:pointer;
      transition:.15s;
      display:flex;
      flex-direction:column;
      gap:4px;
    }
    .topic-card:hover{
      background:#fff3e0;
      transform:translateY(-1px);
    }
    .topic-card-title{
      font-size:14px;
      font-weight:600;
    }

    #aiPanel{
      background:#fff;
      border-radius:14px;
      padding:14px;
      box-shadow:0 2px 10px rgba(0,0,0,.07);
      display:flex;
      flex-direction:column;
      gap:8px;
      min-height:260px;
    }
    #aiPanel h3{
      font-size:15px;
      margin-bottom:4px;
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:6px;
    }
    #aiLimit{font-size:11px;}
    .chat-note{
      font-size:11px;
      color:#6b5f55;
    }
    .chat-box{
      flex:1;
      border-radius:10px;
      border:1px solid #ffe0b2;
      padding:8px;
      background:#fffdf7;
      font-size:13px;
      overflow-y:auto;
    }
    #aiQuestion{
      width:100%;
      min-height:60px;
      resize:vertical;
      border-radius:10px;
      border:1px solid #ffe0b2;
      padding:8px;
      background:#fffdf7;
    }

    #topicScreen{
      max-width:1000px;
      margin:0 auto;
    }
    .topic-header{
      border-radius:16px 16px 0 0;
      padding:14px 16px;
      background:linear-gradient(90deg,var(--topicColor),var(--main-dark));
      color:#fff;
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:10px;
      flex-wrap:wrap;
    }
    .topic-header-title{
      font-size:18px;
      font-weight:600;
    }
    .topic-header-buttons{
      display:flex;
      gap:6px;
    }
    .btn-topic{
      border:none;
      border-radius:999px;
      padding:6px 12px;
      font-size:12px;
      font-weight:600;
      cursor:pointer;
    }
    .btn-topic.back{
      background:#fff;
      color:var(--topicColor);
    }
    .btn-topic.menu{
      background:rgba(255,255,255,.3);
      color:#fff;
      border:1px solid rgba(255,255,255,.4);
    }

    .topic-body{
      background:#fff;
      border-radius:0 0 16px 16px;
      box-shadow:0 4px 14px rgba(0,0,0,.1);
      padding:16px;
    }

    .grammar-box{
      background:#fff7e6;
      border-left:4px solid var(--topicColor);
      padding:10px 12px;
      border-radius:10px;
      font-size:14px;
    }
    .formula{
      font-family:monospace;
      background:#ffe0b2;
      padding:3px 6px;
      border-radius:6px;
      display:inline-block;
      margin-top:4px;
      margin-right:4px;
    }
    .examples li{
      margin-left:18px;
      margin-bottom:2px;
      font-size:13px;
    }

    .exercise-block{
      border:1px solid #ffe0b2;
      border-radius:12px;
      background:#fffdf7;
      padding:10px 12px;
      margin-bottom:10px;
    }
    .exercise-title{
      font-weight:600;
      font-size:14px;
      margin-bottom:4px;
    }
    .question-row{
      font-size:13px;
      margin-bottom:6px;
      display:flex;
      flex-wrap:wrap;
      gap:6px;
      align-items:center;
    }
    .question-text{
      flex:1 1 160px;
    }
    .options{
      display:flex;
      flex-wrap:wrap;
      gap:4px;
    }
    .options label{
      background:#fff;
      border-radius:999px;
      border:1px solid #ffd180;
      padding:2px 8px;
      cursor:pointer;
      display:inline-flex;
      align-items:center;
      gap:3px;
    }
    .exercise-footer{
      margin-top:6px;
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:8px;
    }

    #teacherScreen .table-wrapper{
      overflow-x:auto;
      margin-top:10px;
    }
    #teacherTable{
      width:100%;
      border-collapse:collapse;
      font-size:12px;
    }
    #teacherTable th,
    #teacherTable td{
      border:1px solid #e0d3c2;
      padding:4px 6px;
      text-align:left;
    }
    #teacherTable th{
      background:#fff3e0;
    }

    @media print{
      header, #loginScreen, #mainMenuScreen, #teacherScreen{
        display:none !important;
      }
      body{background:#fff;}
      #topicScreen{display:block !important;}
      .topic-body{box-shadow:none;border-radius:0;}
    }
  </style>
</head>

<body>
<header>
  <div class="brand">
    <img src="logo.png" class="logo-img" alt="AI Bayan logo">
    <div class="brand-text">
      <h1>ENGLISH WITH AI BAYAN</h1>
      <span>Advanced ¬∑ 30 grammar topics</span>
    </div>
  </div>
  <div class="top-info" id="topInfo">Not logged in</div>
</header>

<main>

  <!-- LOGIN -->
  <section id="loginScreen" class="card">
    <h2 class="section-title">Login</h2>
    <p class="muted">Enter your <strong>Name</strong> and <strong>Code</strong>. Ask your teacher for the code.</p>

    <label class="field-label" for="loginName">Name</label>
    <input id="loginName" class="text-input" type="text" placeholder="Your name">

    <label class="field-label" for="loginCode">Code</label>
    <input id="loginCode" class="text-input" type="password" placeholder="Student or teacher code">

    <div style="display:flex;gap:8px;margin-top:4px">
      <button class="btn btn-primary" onclick="handleLogin()">Login</button>
      <button class="btn btn-ghost" onclick="backToLogin()">Reset</button>
    </div>

    <div id="loginError" class="error hidden"></div>
  </section>

  <!-- MAIN MENU -->
  <section id="mainMenuScreen" class="hidden">
    <section class="card">
      <div class="top-row">
        <div>
          <h2 class="section-title">Advanced grammar topics</h2>
          <div id="menuInfo" class="muted"></div>
        </div>
        <div>
          <span class="stars-badge">
            <span class="star-icon">‚≠ê</span>
            Stars: <span id="menuStars">0</span>
          </span>
        </div>
      </div>

      <div class="topics-grid" id="menuTopics"></div>
    </section>

    <!-- AI PANEL (–¥–µ–º–æ) -->
    <aside id="aiPanel">
      <div>
        <h3>AI Bayan <span id="aiLimit">¬∑ demo mode</span></h3>
        <p class="chat-note">
          In the future AI Bayan will answer your grammar questions here. Now use the topics and exercises.
        </p>
      </div>
      <div id="chatBox" class="chat-box">
        <div>Welcome to <strong>Advanced</strong> level. Complete topics to collect stars ‚≠ê.</div>
      </div>
      <div>
        <textarea id="aiQuestion" disabled placeholder="AI chat is disabled in this demo."></textarea>
        <div class="chat-actions">
          <button class="btn btn-primary" id="askBtn" disabled>Ask AI Bayan</button>
        </div>
      </div>
    </aside>
  </section>

  <!-- TOPIC SCREEN -->
  <section id="topicScreen" class="hidden">
    <div class="topic-header">
      <div class="topic-header-title" id="topicHeaderTitle">Topic</div>
      <div class="topic-header-buttons">
        <button class="btn-topic back" onclick="backToMenu()">‚Üê Back</button>
        <button class="btn-topic menu" onclick="backToMenu()">üè†</button>
        <button class="btn-topic menu" onclick="window.print()">üñ®</button>
      </div>
    </div>

    <div class="topic-body">
      <div id="topicRuleContainer"></div>
      <div id="topicExercisesContainer"></div>
      <div id="topicStatus" class="muted" style="margin-top:8px;"></div>
    </div>
  </section>

  <!-- TEACHER SCREEN -->
  <section id="teacherScreen" class="hidden card">
    <div style="display:flex;justify-content:space-between;align-items:center;gap:8px;">
      <button class="btn btn-ghost" onclick="backToLogin()">‚Üê Back</button>
      <span class="muted">Teacher mode ¬∑ code 6678</span>
    </div>

    <h2 class="section-title" style="margin-top:10px;">Teacher dashboard</h2>
    <p class="muted">Shows stars and how many topics each student has used their attempt on.</p>

    <div class="table-wrapper">
      <table id="teacherTable">
        <thead>
          <tr>
            <th>Class</th>
            <th>Code</th>
            <th>Name</th>
            <th>Stars</th>
            <th>Last login</th>
            <th>Topics used</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>
  </section>

</main>

<script>
/* ---------- CLASS RANGES (PIN) ---------- */

const classRanges = [
  { cls: "3E",  from: 101,  to: 115 },
  { cls: "4G",  from: 201,  to: 215 },
  { cls: "5G",  from: 301,  to: 315 },
  { cls: "5Zh", from: 401,  to: 415 },
  { cls: "6G",  from: 501,  to: 515 },
  { cls: "7B",  from: 601,  to: 615 },
  { cls: "7V",  from: 701,  to: 715 },
  { cls: "8E",  from: 801,  to: 815 },
  { cls: "9Zh", from: 901,  to: 915 },
  { cls: "10A", from: 1001, to: 1015 }
];

function getClassByCode(num){
  for(const r of classRanges){
    if(num >= r.from && num <= r.to) return r.cls;
  }
  return null;
}

/* ---------- TOPIC COLORS (1‚Äì30) ---------- */

const topicColors = {
  1:"#f4511e",
  2:"#fb8c00",
  3:"#ef6c00",
  4:"#ff7043",
  5:"#ff8f00",
  6:"#ffb300",
  7:"#f57c00",
  8:"#e64a19",
  9:"#ff9100",
  10:"#ff6f00",
  11:"#f9a825",
  12:"#ffb74d",
  13:"#ffa726",
  14:"#ff9800",
  15:"#ffcc80",
  16:"#ffb300",
  17:"#fb8c00",
  18:"#f57c00",
  19:"#ef6c00",
  20:"#e65100",
  21:"#ff7043",
  22:"#ff6f00",
  23:"#ff8f00",
  24:"#ffa000",
  25:"#ffb300",
  26:"#ffca28",
  27:"#ffb74d",
  28:"#ffa726",
  29:"#ff9800",
  30:"#ff6f00"
};

/* ---------- TOPICS 1‚Äì30 (–∫–æ—Ä–æ—Ç–∫–∏–µ, —É –∫–∞–∂–¥–æ–π 1 –±–ª–æ–∫ —É–ø—Ä.) ---------- */

const topics = [
  {
    id:1,
    title:"Inversion after negative adverbials",
    level:"Advanced",
    explanation:"We use inversion (auxiliary + subject) after negative or limiting adverbials like never, hardly, rarely, only then to sound more formal or emphatic.",
    ruleRu:"–ü–æ—Å–ª–µ –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã—Ö –Ω–∞—Ä–µ—á–∏–π (never, hardly, seldom, only then –∏ –¥—Ä.) –∏—Å–ø–æ–ª—å–∑—É–µ–º –∏–Ω–≤–µ—Ä—Å–∏—é: –≤—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–π –≥–ª–∞–≥–æ–ª + –ø–æ–¥–ª–µ–∂–∞—â–µ–µ + —Å–º—ã—Å–ª–æ–≤–æ–π –≥–ª–∞–≥–æ–ª.",
    formulas:[
      "Never / Rarely / Seldom + AUX + S + V",
      "Not until + clause + AUX + S + V",
      "Only then / only later + AUX + S + V"
    ],
    examples:[
      "Never have I seen such chaos.",
      "Only then did she realise her mistake."
    ],
    exercises:[
      {
        title:"Choose the correct sentence (inversion)",
        questions:[
          {
            text:"–ù–∏–∫–æ–≥–¥–∞ —Ä–∞–Ω—å—à–µ —è –Ω–µ –≤–∏–¥–µ–ª —Ç–∞–∫–æ–≥–æ —Ñ–∏–ª—å–º–∞.",
            options:[
              "Never before have I seen such a film.",
              "Never before I have seen such a film."
            ],
            correct:0
          },
          {
            text:"–¢–æ–ª—å–∫–æ —Ç–æ–≥–¥–∞ –æ–Ω –ø–æ–Ω—è–ª —Å–≤–æ—é –æ—à–∏–±–∫—É.",
            options:[
              "Only then did he understand his mistake.",
              "Only then he understood his mistake."
            ],
            correct:0
          },
          {
            text:"–ï–¥–≤–∞ –æ–Ω –≤—ã—à–µ–ª, –∫–∞–∫ –Ω–∞—á–∞–ª—Å—è –¥–æ–∂–¥—å.",
            options:[
              "Hardly had he left when it started to rain.",
              "Hardly he had left when it started to rain."
            ],
            correct:0
          }
        ]
      }
    ]
  },

  {
    id:2,
    title:"Cleft sentences for emphasis",
    level:"Advanced",
    explanation:"Cleft sentences with It is/was and What... is/was help us emphasise a person, thing, time, place or reason.",
    ruleRu:"It is/was + X + who/that...; What + –ø—Ä–∏–¥–∞—Ç–æ—á–Ω–æ–µ + is/was + X ‚Äì —á—Ç–æ–±—ã –≤—ã–¥–µ–ª–∏—Ç—å –≤–∞–∂–Ω—É—é —á–∞—Å—Ç—å –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è.",
    formulas:[
      "It was X who/that + clause",
      "What + clause + is X"
    ],
    examples:[
      "It was my brother who broke the window.",
      "What I need is a break."
    ],
    exercises:[
      {
        title:"Choose the correct cleft sentence",
        questions:[
          {
            text:"–ü–æ–¥—á–µ—Ä–∫–Ω–∏ —á–µ–ª–æ–≤–µ–∫–∞: My sister helped me.",
            options:[
              "It was my sister who helped me.",
              "It was who helped me my sister."
            ],
            correct:0
          },
          {
            text:"–ü–æ–¥—á–µ—Ä–∫–Ω–∏ –æ–±—ä–µ–∫—Ç: I need your advice.",
            options:[
              "What I need is your advice.",
              "It is your advice what I need."
            ],
            correct:0
          },
          {
            text:"–ü–æ–¥—á–µ—Ä–∫–Ω–∏ –≤—Ä–µ–º—è: I met him yesterday.",
            options:[
              "It was yesterday that I met him.",
              "Yesterday it was that I met him."
            ],
            correct:0
          }
        ]
      }
    ]
  },

  {
    id:3,
    title:"Mixed conditionals",
    level:"Advanced",
    explanation:"Mixed conditionals connect unreal past actions with present results or unreal present states with unreal past results.",
    ruleRu:"If + Past Perfect ‚Üí would + V (—Å–µ–π—á–∞—Å —Ä–µ–∑—É–ª—å—Ç–∞—Ç). If + Past Simple ‚Üí would have + V3 (–ø—Ä–æ—à–ª—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç).",
    formulas:[
      "If + Past Perfect, would + V (now)",
      "If + Past Simple, would have + V3"
    ],
    examples:[
      "If I had studied harder, I would be at university now.",
      "If she were more careful, she would not have lost the documents."
    ],
    exercises:[
      {
        title:"Choose the correct mixed conditional",
        questions:[
          {
            text:"–ñ–∞–ª—å, —á—Ç–æ —è –º–∞–ª–æ —É—á–∏–ª—Å—è ‚Äì —Å–µ–π—á–∞—Å –º–Ω–µ —Ç—Ä—É–¥–Ω–æ.",
            options:[
              "If I had studied more, it would be easier now.",
              "If I studied more, it would have been easier now."
            ],
            correct:0
          },
          {
            text:"–ï—Å–ª–∏ –±—ã –æ–Ω –±—ã–ª —Ç–µ—Ä–ø–µ–ª–∏–≤–µ–µ, –æ–Ω –±—ã –Ω–µ –Ω–∞–∫—Ä–∏—á–∞–ª –≤—á–µ—Ä–∞.",
            options:[
              "If he were more patient, he would not have shouted yesterday.",
              "If he had been more patient, he would not shout yesterday."
            ],
            correct:0
          },
          {
            text:"–ï—Å–ª–∏ –±—ã –æ–Ω–∏ –Ω–µ –ø–µ—Ä–µ–µ—Ö–∞–ª–∏, –º—ã –±—ã —Å–µ–π—á–∞—Å —á–∞—Å—Ç–æ –≤—Å—Ç—Ä–µ—á–∞–ª–∏—Å—å.",
            options:[
              "If they had not moved, we would see each other often now.",
              "If they did not move, we would have seen each other often now."
            ],
            correct:0
          }
        ]
      }
    ]
  },

  {
    id:4,
    title:"Modal verbs of deduction",
    level:"Advanced",
    explanation:"We use must, might, may, could and can‚Äôt to say how sure we are about something in the present or past.",
    ruleRu:"Must ‚Äì –ø–æ—á—Ç–∏ —É–≤–µ—Ä–µ–Ω—ã; can‚Äôt ‚Äì —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ –Ω–µ–≤–æ–∑–º–æ–∂–Ω–æ; might/may/could ‚Äì –≤–æ–∑–º–æ–∂–Ω–æ. –î–ª—è –ø—Ä–æ—à–ª–æ–≥–æ: modal + have + V3.",
    formulas:[
      "He must be at home.",
      "He must have forgotten.",
      "She can‚Äôt be serious.",
      "She can‚Äôt have finished."
    ],
    examples:[
      "He must be tired ‚Äì he worked all day.",
      "She can‚Äôt have left ‚Äì her bag is here."
    ],
    exercises:[
      {
        title:"Choose the best modal for deduction",
        questions:[
          {
            text:"The lights are on. He ___ be at home.",
            options:["must","can‚Äôt"],
            correct:0
          },
          {
            text:"The road is dry. It ___ have rained last night.",
            options:["can‚Äôt","must"],
            correct:0
          },
          {
            text:"She looks happy. She ___ have got good news.",
            options:["might","can‚Äôt"],
            correct:0
          }
        ]
      }
    ]
  },

  {
    id:5,
    title:"Wishes and regrets (I wish / If only)",
    level:"Advanced",
    explanation:"We use I wish / If only + Past Simple for present regrets, + Past Perfect for past regrets, and wish + would to criticise behaviour.",
    ruleRu:"I wish / If only + Past Simple ‚Üí —Å–æ–∂–∞–ª–µ–Ω–∏–µ –æ –Ω–∞—Å—Ç–æ—è—â–µ–º. I wish / If only + Past Perfect ‚Üí —Å–æ–∂–∞–ª–µ–Ω–∏–µ –æ –ø—Ä–æ—à–ª–æ–º. I wish + would ‚Üí —Ö–æ—Ç–µ–ª–æ—Å—å –±—ã, —á—Ç–æ–±—ã –∫—Ç–æ-—Ç–æ –∏–∑–º–µ–Ω–∏–ª—Å—è.",
    formulas:[
      "I wish I knew.",
      "If only I had studied.",
      "I wish you would listen."
    ],
    examples:[
      "I wish I had more free time.",
      "If only I hadn‚Äôt said that."
    ],
    exercises:[
      {
        title:"Choose the correct wish / regret",
        questions:[
          {
            text:"–ñ–∞–ª—å, —á—Ç–æ —É –º–µ–Ω—è —Å–µ–π—á–∞—Å –Ω–µ—Ç –º–∞—à–∏–Ω—ã.",
            options:[
              "I wish I had a car now.",
              "I wish I have a car now."
            ],
            correct:0
          },
          {
            text:"–ñ–∞–ª—å, —á—Ç–æ –≤—á–µ—Ä–∞ —è –Ω–µ –ø–æ–¥–≥–æ—Ç–æ–≤–∏–ª—Å—è.",
            options:[
              "If only I had prepared yesterday.",
              "If only I prepared yesterday."
            ],
            correct:0
          },
          {
            text:"–ú–µ–Ω—è —Ä–∞–∑–¥—Ä–∞–∂–∞–µ—Ç, —á—Ç–æ –æ–Ω –æ–ø–∞–∑–¥—ã–≤–∞–µ—Ç.",
            options:[
              "I wish he wouldn‚Äôt be late.",
              "I wish he isn‚Äôt late."
            ],
            correct:0
          }
        ]
      }
    ]
  },

  {
    id:6,
    title:"Passive reporting structures",
    level:"Advanced",
    explanation:"We use passive reporting structures with say, think, believe, report, know etc. to sound more formal and impersonal.",
    ruleRu:"It is said that..., It is believed that..., He is thought to..., They are reported to have....",
    formulas:[
      "It is said that + clause",
      "S is thought / believed to + V",
      "S is reported to have + V3"
    ],
    examples:[
      "It is believed that the plan will work.",
      "He is said to be very rich."
    ],
    exercises:[
      {
        title:"Choose the correct passive report",
        questions:[
          {
            text:"People say that he is honest.",
            options:[
              "It is said that he is honest.",
              "He is said that he is honest."
            ],
            correct:0
          },
          {
            text:"They think she left the city.",
            options:[
              "She is thought to have left the city.",
              "It is thought that she to have left the city."
            ],
            correct:0
          },
          {
            text:"They report that the train was delayed.",
            options:[
              "The train is reported to have been delayed.",
              "It is reported that the train to be delayed."
            ],
            correct:0
          }
        ]
      }
    ]
  },

  {
    id:7,
    title:"Participle clauses",
    level:"Advanced",
    explanation:"Participle clauses (V-ing, V3, having V3) make sentences more compact and are common in written English.",
    ruleRu:"V-ing / V3 / having V3 –≤ –Ω–∞—á–∞–ª–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è –∑–∞–º–µ–Ω—è—é—Ç –ø—Ä–∏–¥–∞—Ç–æ—á–Ω—ã–µ: Walking along the street, I saw..., Built in 2000, the bridge..., Having finished, he left.",
    formulas:[
      "Walking along the street, S + V",
      "Built in 2000, S + V",
      "Having finished, S + V"
    ],
    examples:[
      "Feeling tired, she went to bed.",
      "Built many years ago, the house needs repair."
    ],
    exercises:[
      {
        title:"Choose the correct participle clause",
        questions:[
          {
            text:"–ö–æ–≥–¥–∞ –æ–Ω –∑–∞–∫–æ–Ω—á–∏–ª —Ä–∞–±–æ—Ç—É, –æ–Ω —É—à—ë–ª –¥–æ–º–æ–π.",
            options:[
              "Having finished his work, he went home.",
              "Finished his work, he went home."
            ],
            correct:0
          },
          {
            text:"–ü–æ—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π –≤ 2010, –º–æ—Å—Ç –¥–æ —Å–∏—Ö –ø–æ—Ä –±–µ–∑–æ–ø–∞—Å–µ–Ω.",
            options:[
              "Built in 2010, the bridge is still safe.",
              "Building in 2010, the bridge is still safe."
            ],
            correct:0
          },
          {
            text:"–ù–µ –∑–Ω–∞—è –æ—Ç–≤–µ—Ç–∞, –æ–Ω –ø—Ä–æ–º–æ–ª—á–∞–ª.",
            options:[
              "Not knowing the answer, he kept silent.",
              "Knowing not the answer, he kept silent."
            ],
            correct:0
          }
        ]
      }
    ]
  },

  {
    id:8,
    title:"Advanced linking words (contrast & concession)",
    level:"Advanced",
    explanation:"We use although/even though, whereas/while, in spite of/despite, however/nevertheless to show contrast and concession.",
    ruleRu:"Although / even though + –ø—Ä–∏–¥–∞—Ç–æ—á–Ω–æ–µ; in spite of / despite + —Å—É—â–µ—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ–µ / V-ing; whereas / while –¥–ª—è –ø—Ä–æ—Ç–∏–≤–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∏—è; however / nevertheless ‚Äì –≤ –Ω–∞—á–∞–ª–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è.",
    formulas:[
      "Although + clause",
      "Despite / In spite of + noun / V-ing",
      "S1 ..., whereas S2 ...",
      "S1. However, S2."
    ],
    examples:[
      "Although it was cold, we went out.",
      "Despite the rain, they played football."
    ],
    exercises:[
      {
        title:"Choose the best linker",
        questions:[
          {
            text:"___ it was late, they continued talking.",
            options:["Although","Despite"],
            correct:0
          },
          {
            text:"___ the rain, we didn‚Äôt cancel the trip.",
            options:["Despite","Although"],
            correct:0
          },
          {
            text:"She is very calm, ___ her brother is emotional.",
            options:["whereas","despite"],
            correct:0
          }
        ]
      }
    ]
  },

  {
    id:9,
    title:"Reporting verbs and patterns",
    level:"Advanced",
    explanation:"Different reporting verbs take different structures: say, tell, suggest, recommend, deny, admit, accuse, insist etc.",
    ruleRu:"say (that) + clause; tell + object + (that); suggest / recommend + V-ing / that + clause; deny / admit + V-ing; accuse sb of V-ing; insist on V-ing.",
    formulas:[
      "He said (that) he was tired.",
      "She told me (that) she was busy.",
      "He suggested going home.",
      "They accused him of cheating."
    ],
    examples:[
      "The doctor recommended having a rest.",
      "She denied taking the money."
    ],
    exercises:[
      {
        title:"Choose the correct pattern",
        questions:[
          {
            text:"–û–Ω –ø—Ä–µ–¥–ª–æ–∂–∏–ª –ø–æ–π—Ç–∏ –≤ –∫–∏–Ω–æ.",
            options:[
              "He suggested going to the cinema.",
              "He suggested to go to the cinema."
            ],
            correct:0
          },
          {
            text:"–û–Ω–∏ –æ–±–≤–∏–Ω–∏–ª–∏ –µ–≥–æ –≤ –∫—Ä–∞–∂–µ.",
            options:[
              "They accused him of stealing.",
              "They accused him for stealing."
            ],
            correct:0
          },
          {
            text:"–û–Ω –æ—Ç—Ä–∏—Ü–∞–ª, —á—Ç–æ —Å–ø–∏—Å—ã–≤–∞–ª.",
            options:[
              "He denied cheating.",
              "He denied to cheat."
            ],
            correct:0
          }
        ]
      }
    ]
  },

  {
    id:10,
    title:"Relative clauses with prepositions",
    level:"Advanced",
    explanation:"In formal English we can put prepositions before relative pronouns (to whom, with whom, about which). In spoken English prepositions usually come at the end.",
    ruleRu:"–§–æ—Ä–º–∞–ª—å–Ω–æ: the person to whom I spoke; —Ä–∞–∑–≥–æ–≤–æ—Ä–Ω–æ: the person who I spoke to.",
    formulas:[
      "the person to whom I spoke",
      "the person who I spoke to",
      "the topic about which we talked",
      "the topic we talked about"
    ],
    examples:[
      "The professor to whom I spoke was very helpful.",
      "The girl who I was talking to is my cousin."
    ],
    exercises:[
      {
        title:"Choose the correct relative clause",
        questions:[
          {
            text:"–≠—Ç–æ —á–µ–ª–æ–≤–µ–∫. –Ø –≥–æ–≤–æ—Ä–∏–ª —Å –Ω–∏–º –≤—á–µ—Ä–∞.",
            options:[
              "This is the person I spoke to yesterday.",
              "This is the person to who I spoke yesterday."
            ],
            correct:0
          },
          {
            text:"–≠—Ç–æ —Ç–µ–º–∞, –æ –∫–æ—Ç–æ—Ä–æ–π –º—ã –±—É–¥–µ–º –≥–æ–≤–æ—Ä–∏—Ç—å.",
            options:[
              "This is the topic we are going to talk about.",
              "This is the topic about which we are going to talk about."
            ],
            correct:0
          },
          {
            text:"–≠—Ç–æ —É—á–∏—Ç–µ–ª—å, —É –∫–æ—Ç–æ—Ä–æ–≥–æ —è –º–Ω–æ–≥–æ–º—É –Ω–∞—É—á–∏–ª—Å—è.",
            options:[
              "This is the teacher from whom I have learnt a lot.",
              "This is the teacher whom I have learnt a lot from him."
            ],
            correct:0
          }
        ]
      }
    ]
  },

  /* ---- –î–∞–ª—å—à–µ —Ç–µ–º—ã 11‚Äì30 –ø–æ–ø—Ä–æ—â–µ, –Ω–æ –≤ —Ç–æ–º –∂–µ —Ñ–æ—Ä–º–∞—Ç–µ ---- */

  {
    id:11,
    title:"Nominalisation in formal writing",
    level:"Advanced",
    explanation:"Nominalisation means turning verbs or adjectives into nouns to make writing more formal and compact.",
    ruleRu:"Nominalisation ‚Äì –ø—Ä–µ–≤—Ä–∞—â–µ–Ω–∏–µ –≥–ª–∞–≥–æ–ª–æ–≤/–ø—Ä–∏–ª–∞–≥–∞—Ç–µ–ª—å–Ω—ã—Ö –≤ —Å—É—â–µ—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã–µ: decide ‚Üí decision, fail ‚Üí failure, accurate ‚Üí accuracy.",
    formulas:[
      "decide ‚Üí decision",
      "develop ‚Üí development",
      "fail ‚Üí failure"
    ],
    examples:[
      "Their decision to change the plan surprised everyone.",
      "There was a significant improvement in accuracy."
    ],
    exercises:[
      {
        title:"Choose the best nominalisation",
        questions:[
          {
            text:"We decided to start the project.",
            options:[
              "Their decision to start the project was made.",
              "Their decide to start the project was made."
            ],
            correct:0
          },
          {
            text:"The data is accurate.",
            options:[
              "The accuracy of the data is high.",
              "The accurateness of the data is high."
            ],
            correct:0
          },
          {
            text:"The company failed to improve.",
            options:[
              "There was no improvement in the company.",
              "There was no improve in the company."
            ],
            correct:0
          }
        ]
      }
    ]
  },

  {
    id:12,
    title:"Ellipsis and substitution",
    level:"Advanced",
    explanation:"Ellipsis means omitting repeated words; substitution means replacing them with one word (do, one, so).",
    ruleRu:"Ellipsis ‚Äì –ø—Ä–æ–ø—É—Å–∫ –ø–æ–≤—Ç–æ—Ä—è—é—â–∏—Ö—Å—è —Å–ª–æ–≤; substitution ‚Äì –∑–∞–º–µ–Ω–∞ –∏—Ö —Å–ª–æ–≤–∞–º–∏ one / ones / do / so.",
    formulas:[
      "I think so. ‚Äì I hope so too.",
      "Do you like it? ‚Äì Yes, I do.",
      "I‚Äôll take the red one."
    ],
    examples:[
      "‚ÄòDo you need help?‚Äô ‚Äì ‚ÄòYes, I do.‚Äô",
      "‚ÄòWhich dress?‚Äô ‚Äì ‚ÄòThe red one.‚Äô"
    ],
    exercises:[
      {
        title:"Choose ellipsis or substitution",
        questions:[
          {
            text:"‚ÄòDo you like this song?‚Äô ‚Äì ‚ÄòYes, ___.‚Äô",
            options:["I do","I like"],
            correct:0
          },
          {
            text:"‚ÄòWhich pen do you want?‚Äô ‚Äì ‚ÄòThe blue ___.‚Äô",
            options:["one","it"],
            correct:0
          },
          {
            text:"I think so, and my friends think ___ too.",
            options:["so","it"],
            correct:0
          }
        ]
      }
    ]
  },

  {
    id:13,
    title:"Hedging language",
    level:"Advanced",
    explanation:"Hedging makes statements less direct and more careful using might, seem, appear, tend to, kind of, a bit.",
    ruleRu:"Hedging ‚Äì —Å–º—è–≥—á–µ–Ω–∏–µ –≤—ã—Å–∫–∞–∑—ã–≤–∞–Ω–∏–π: It seems that..., It might be..., He tends to..., It is rather / somewhat difficult.",
    formulas:[
      "It seems that...",
      "It might be...",
      "He tends to..."
    ],
    examples:[
      "It seems that the results are not reliable.",
      "He tends to be late for meetings."
    ],
    exercises:[
      {
        title:"Choose the best hedge",
        questions:[
          {
            text:"–ì–æ–≤–æ—Ä–∏–º –æ—Å—Ç–æ—Ä–æ–∂–Ω–æ: The plan is bad.",
            options:[
              "The plan seems rather weak.",
              "The plan is absolutely terrible."
            ],
            correct:0
          },
          {
            text:"–ì–æ–≤–æ—Ä–∏–º –º—è–≥–∫–æ: It is wrong.",
            options:[
              "It might not be the best option.",
              "It is completely wrong and awful."
            ],
            correct:0
          },
          {
            text:"–ì–æ–≤–æ—Ä–∏–º –æ—Å—Ç–æ—Ä–æ–∂–Ω–æ: He is lazy.",
            options:[
              "He tends to avoid hard work.",
              "He is lazy and useless."
            ],
            correct:0
          }
        ]
      }
    ]
  },

  {
    id:14,
    title:"Emphatic do / did",
    level:"Advanced",
    explanation:"We use do/does/did in affirmative sentences to emphasise the verb.",
    ruleRu:"–î–ª—è —É—Å–∏–ª–µ–Ω–∏—è: I do understand, He does care, She did try.",
    formulas:[
      "I do understand.",
      "He does care.",
      "She did try."
    ],
    examples:[
      "I do agree with you.",
      "She did finish the report on time."
    ],
    exercises:[
      {
        title:"Choose the emphatic sentence",
        questions:[
          {
            text:"–Ø –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ –ø–æ–Ω–∏–º–∞—é –≤–∞—Å.",
            options:[
              "I do understand you.",
              "I understand you do."
            ],
            correct:0
          },
          {
            text:"–û–Ω –ø—Ä–∞–≤–¥–∞ –∑–∞–±–æ—Ç–∏—Ç—Å—è –æ –ø—Ä–æ–µ–∫—Ç–µ.",
            options:[
              "He does care about the project.",
              "He cares about the project does."
            ],
            correct:0
          },
          {
            text:"–û–Ω–∞ –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ –ø—ã—Ç–∞–ª–∞—Å—å.",
            options:[
              "She did try.",
              "She tried did."
            ],
            correct:0
          }
        ]
      }
    ]
  },

  {
    id:15,
    title:"Narrative tenses review",
    level:"Advanced",
    explanation:"We mix Past Simple, Past Continuous and Past Perfect to tell stories clearly.",
    ruleRu:"Past Simple ‚Äì –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å; Past Continuous ‚Äì —Ñ–æ–Ω; Past Perfect ‚Äì –ø—Ä–µ–¥—à–µ—Å—Ç–≤—É—é—â–∏–µ –¥–µ–π—Å—Ç–≤–∏—è.",
    formulas:[
      "Past Simple",
      "Past Continuous",
      "Past Perfect"
    ],
    examples:[
      "I had finished dinner when she arrived.",
      "He was walking home when it started to rain."
    ],
    exercises:[
      {
        title:"Choose the correct tense",
        questions:[
          {
            text:"When I ___ (finish) the test, the bell rang.",
            options:["had finished","was finishing"],
            correct:0
          },
          {
            text:"He ___ (walk) home when he saw an accident.",
            options:["was walking","had walked"],
            correct:0
          },
          {
            text:"She was tired because she ___ (work) all day.",
            options:["had worked","was working"],
            correct:0
          }
        ]
      }
    ]
  },

  {
    id:16,
    title:"Future in the past",
    level:"Advanced",
    explanation:"We use was/were going to, would, was about to to talk about future from a past point of view.",
    ruleRu:"was/were going to ‚Äì —Å–æ–±–∏—Ä–∞–ª—Å—è; would ‚Äì –±—É–¥—É—â–µ–µ —Ç–æ–≥–¥–∞; was about to ‚Äì –≤–æ—Ç-–≤–æ—Ç —Å–æ–±—Ä–∞–ª—Å—è.",
    formulas:[
      "He was going to call.",
      "She said she would help.",
      "I was about to leave."
    ],
    examples:[
      "I was going to tell you, but I forgot.",
      "She promised she would come."
    ],
    exercises:[
      {
        title:"Choose the correct form",
        questions:[
          {
            text:"–û–Ω —Å–æ–±–∏—Ä–∞–ª—Å—è –ø–æ–∑–≤–æ–Ω–∏—Ç—å, –Ω–æ –∑–∞–±—ã–ª.",
            options:[
              "He was going to call, but he forgot.",
              "He will call, but he forgot."
            ],
            correct:0
          },
          {
            text:"–û–Ω–∞ —Å–∫–∞–∑–∞–ª–∞, —á—Ç–æ –ø–æ–º–æ–∂–µ—Ç.",
            options:[
              "She said she would help.",
              "She said she will help."
            ],
            correct:0
          },
          {
            text:"–Ø —É–∂–µ —Å–æ–±–∏—Ä–∞–ª—Å—è –≤—ã—Ö–æ–¥–∏—Ç—å, –∫–æ–≥–¥–∞ –æ–Ω –ø—Ä–∏—à—ë–ª.",
            options:[
              "I was about to leave when he arrived.",
              "I about to leave when he arrived."
            ],
            correct:0
          }
        ]
      }
    ]
  },

  {
    id:17,
    title:"Advanced use of articles",
    level:"Advanced",
    explanation:"We use a/an, the and zero article with abstract nouns, institutions, places and unique objects in advanced ways.",
    ruleRu:"the –¥–ª—è —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö –æ–±—ä–µ–∫—Ç–æ–≤ –∏ –∫–æ–Ω–∫—Ä–µ—Ç–∏–∑–∞—Ü–∏–∏; –Ω—É–ª–µ–≤–æ–π –∞—Ä—Ç–∏–∫–ª—å —Å –∞–±—Å—Ç—Ä–∞–∫—Ç–Ω—ã–º–∏ –∏ –Ω–µ–∏—Å—á–∏—Å–ª—è–µ–º—ã–º–∏ –≤ –æ–±—â–µ–º –∑–Ω–∞—á–µ–Ω–∏–∏.",
    formulas:[
      "the environment",
      "go to school / go to the school",
      "the internet"
    ],
    examples:[
      "Protection of the environment is important.",
      "He is in hospital, but his parents are at the hospital."
    ],
    exercises:[
      {
        title:"Choose the correct article",
        questions:[
          {
            text:"___ environment must be protected.",
            options:["The","‚Äî"],
            correct:0
          },
          {
            text:"She goes to ___ school by bus.",
            options:["‚Äî","the"],
            correct:0
          },
          {
            text:"I found it on ___ internet.",
            options:["the","‚Äî"],
            correct:0
          }
        ]
      }
    ]
  },

  {
    id:18,
    title:"Formal vs informal style",
    level:"Advanced",
    explanation:"Some words and structures are more formal (obtain, therefore), others more informal (get, so).",
    ruleRu:"–§–æ—Ä–º–∞–ª—å–Ω—ã–π —Å—Ç–∏–ª—å: obtain, request, therefore; –Ω–µ—Ñ–æ—Ä–º–∞–ª—å–Ω—ã–π: get, ask for, so.",
    formulas:[
      "get ‚Üí obtain / receive",
      "so ‚Üí therefore",
      "buy ‚Üí purchase"
    ],
    examples:[
      "We therefore decided to postpone the meeting.",
      "I got your message. (informal)"
    ],
    exercises:[
      {
        title:"Choose the more formal option",
        questions:[
          {
            text:"–ú—ã —Ä–µ—à–∏–ª–∏ –∫—É–ø–∏—Ç—å –Ω–æ–≤–æ–µ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ.",
            options:[
              "We decided to purchase new equipment.",
              "We decided to buy new stuff."
            ],
            correct:0
          },
          {
            text:"–ü–æ—ç—Ç–æ–º—É –º—ã –∏–∑–º–µ–Ω–∏–ª–∏ –ø–ª–∞–Ω.",
            options:[
              "Therefore, we changed the plan.",
              "So, we changed the plan."
            ],
            correct:0
          },
          {
            text:"–ú—ã –ø–æ–ª—É—á–∏–ª–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –≤—á–µ—Ä–∞.",
            options:[
              "We obtained the results yesterday.",
              "We got the results yesterday."
            ],
            correct:0
          }
        ]
      }
    ]
  },

  {
    id:19,
    title:"Reduced relative clauses",
    level:"Advanced",
    explanation:"We can shorten relative clauses: Students who live in dorms ‚Üí Students living in dorms.",
    ruleRu:"who/that + be + V-ing / V3 –º–æ–∂–Ω–æ —Å–æ–∫—Ä–∞—Ç–∏—Ç—å: people who are waiting ‚Üí people waiting.",
    formulas:[
      "students who live ‚Üí students living",
      "books which are written ‚Üí books written"
    ],
    examples:[
      "People living in the city often travel by metro.",
      "The book written by my friend is popular."
    ],
    exercises:[
      {
        title:"Choose the reduced form",
        questions:[
          {
            text:"Students who live in dormitories often share rooms.",
            options:[
              "Students living in dormitories often share rooms.",
              "Students lived in dormitories often share rooms."
            ],
            correct:0
          },
          {
            text:"Cars which are produced here are exported.",
            options:[
              "Cars produced here are exported.",
              "Cars producing here are exported."
            ],
            correct:0
          },
          {
            text:"People who are waiting outside are tired.",
            options:[
              "People waiting outside are tired.",
              "People waited outside are tired."
            ],
            correct:0
          }
        ]
      }
    ]
  },

  {
    id:20,
    title:"Complex noun phrases",
    level:"Advanced",
    explanation:"English academic style often uses long noun phrases: the rapid economic growth of the region.",
    ruleRu:"–°–ª–æ–∂–Ω—ã–µ –∏–º–µ–Ω–Ω—ã–µ –≥—Ä—É–ø–ø—ã: –ø—Ä–∏–ª–∞–≥–∞—Ç–µ–ª—å–Ω—ã–µ + —Å—É—â–µ—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã–µ + of-—Ñ—Ä–∞–∑—ã: rapid economic growth of the region.",
    formulas:[
      "adjective + noun + of + noun",
      "noun + noun (energy consumption)"
    ],
    examples:[
      "The rapid economic growth of the region continues.",
      "Energy consumption of households is rising."
    ],
    exercises:[
      {
        title:"Choose the best complex noun phrase",
        questions:[
          {
            text:"—Ä–æ—Å—Ç –Ω–∞—Å–µ–ª–µ–Ω–∏—è –≥–æ—Ä–æ–¥–∞",
            options:[
              "the population growth of the city",
              "the growth of population of the city people"
            ],
            correct:0
          },
          {
            text:"—É—Ä–æ–≤–µ–Ω—å –∑–∞–≥—Ä—è–∑–Ω–µ–Ω–∏—è –≤–æ–∑–¥—É—Ö–∞",
            options:[
              "the level of air pollution",
              "the level of pollution of the air level"
            ],
            correct:0
          },
          {
            text:"—Å–Ω–∏–∂–µ–Ω–∏–µ –ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏—è —ç–Ω–µ—Ä–≥–∏–∏",
            options:[
              "a decrease in energy consumption",
              "a decrease of consume energy"
            ],
            correct:0
          }
        ]
      }
    ]
  },

  {
    id:21,
    title:"Discourse markers",
    level:"Advanced",
    explanation:"Discourse markers organise ideas: firstly, in addition, on the other hand, in conclusion.",
    ruleRu:"–°–≤—è–∑–∫–∏ –¥–ª—è –ª–æ–≥–∏–∫–∏ —Ç–µ–∫—Å—Ç–∞: firstly, secondly, moreover, in addition, however, on the other hand, in conclusion.",
    formulas:[
      "Firstly, ...",
      "In addition, ...",
      "On the other hand, ...",
      "In conclusion, ..."
    ],
    examples:[
      "Firstly, the price is low. In addition, the quality is high.",
      "On the other hand, this option is risky."
    ],
    exercises:[
      {
        title:"Choose the best discourse marker",
        questions:[
          {
            text:"___, I will explain the main idea.",
            options:["Firstly","In conclusion"],
            correct:0
          },
          {
            text:"We need more money. ___, we need more time.",
            options:["In addition","Finally"],
            correct:0
          },
          {
            text:"___, we decided to cancel the project.",
            options:["In conclusion","Firstly"],
            correct:0
          }
        ]
      }
    ]
  },

  {
    id:22,
    title:"Phrasal verbs in formal equivalents",
    level:"Advanced",
    explanation:"Many phrasal verbs have more formal one-word equivalents.",
    ruleRu:"–ù–µ—Ñ–æ—Ä–º–∞–ª—å–Ω—ã–µ —Ñ—Ä–∞–∑–æ–≤—ã–µ: go on, put off, find out; —Ñ–æ—Ä–º–∞–ª—å–Ω—ã–µ: continue, postpone, discover.",
    formulas:[
      "find out ‚Üí discover",
      "put off ‚Üí postpone",
      "go on ‚Üí continue"
    ],
    examples:[
      "The meeting was postponed.",
      "They continued the discussion."
    ],
    exercises:[
      {
        title:"Choose the formal equivalent",
        questions:[
          {
            text:"We decided to put off the meeting.",
            options:[
              "We decided to postpone the meeting.",
              "We decided to delay up the meeting."
            ],
            correct:0
          },
          {
            text:"They went on talking for hours.",
            options:[
              "They continued talking for hours.",
              "They prolonged talking for hours on."
            ],
            correct:0
          },
          {
            text:"We need to find out the reason.",
            options:[
              "We need to discover the reason.",
              "We need to look up the reason out."
            ],
            correct:0
          }
        ]
      }
    ]
  },

  {
    id:23,
    title:"Advanced gerunds and infinitives",
    level:"Advanced",
    explanation:"Some verbs change meaning with gerund or infinitive (remember, stop, try, regret).",
    ruleRu:"remember doing ‚Äì –ø–æ–º–Ω–∏—Ç—å, –∫–∞–∫ –¥–µ–ª–∞–ª; remember to do ‚Äì –Ω–µ –∑–∞–±—ã—Ç—å —Å–¥–µ–ª–∞—Ç—å; stop doing ‚Äì –ø—Ä–µ–∫—Ä–∞—Ç–∏—Ç—å; stop to do ‚Äì –æ—Å—Ç–∞–Ω–æ–≤–∏—Ç—å—Å—è, —á—Ç–æ–±—ã —Å–¥–µ–ª–∞—Ç—å.",
    formulas:[
      "remember doing / remember to do",
      "stop doing / stop to do",
      "regret doing / regret to say"
    ],
    examples:[
      "I remember meeting her.",
      "Remember to lock the door."
    ],
    exercises:[
      {
        title:"Choose gerund or infinitive",
        questions:[
          {
            text:"–ù–µ –∑–∞–±—É–¥—å –∑–∞–∫—Ä—ã—Ç—å –¥–≤–µ—Ä—å.",
            options:[
              "Remember to lock the door.",
              "Remember locking the door."
            ],
            correct:0
          },
          {
            text:"–Ø –ø–æ–º–Ω—é, –∫–∞–∫ –≤—Å—Ç—Ä–µ—Ç–∏–ª –µ–≥–æ –≤ –ü–∞—Ä–∏–∂–µ.",
            options:[
              "I remember meeting him in Paris.",
              "I remember to meet him in Paris."
            ],
            correct:0
          },
          {
            text:"–û–Ω –æ—Å—Ç–∞–Ω–æ–≤–∏–ª—Å—è, —á—Ç–æ–±—ã –ø–æ–≥–æ–≤–æ—Ä–∏—Ç—å —Å–æ –º–Ω–æ–π.",
            options:[
              "He stopped to talk to me.",
              "He stopped talking to me."
            ],
            correct:0
          }
        ]
      }
    ]
  },

  {
    id:24,
    title:"Emphasis with so / such / what",
    level:"Advanced",
    explanation:"We use so, such and what for emphasis in exclamations.",
    ruleRu:"so + adjective/adverb; such + (a/an) + adjective + noun; What a/an + adjective + noun!",
    formulas:[
      "so difficult",
      "such a good idea",
      "What a wonderful day!"
    ],
    examples:[
      "It was such a boring film.",
      "She is so talented!"
    ],
    exercises:[
      {
        title:"Choose the correct emphasis",
        questions:[
          {
            text:"–≠—Ç–æ –±—ã–ª–∞ —Ç–∞–∫–∞—è —Å–∫—É—á–Ω–∞—è –ª–µ–∫—Ü–∏—è!",
            options:[
              "It was such a boring lecture!",
              "It was so a boring lecture!"
            ],
            correct:0
          },
          {
            text:"–û–Ω —Ç–∞–∫–æ–π –¥–æ–±—Ä—ã–π —á–µ–ª–æ–≤–µ–∫.",
            options:[
              "He is such a kind person.",
              "He is so a kind person."
            ],
            correct:0
          },
          {
            text:"–ö–∞–∫–æ–π –∑–∞–º–µ—á–∞—Ç–µ–ª—å–Ω—ã–π –¥–µ–Ω—å!",
            options:[
              "What a wonderful day!",
              "So wonderful day it is!"
            ],
            correct:0
          }
        ]
      }
    ]
  },

  {
    id:25,
    title:"Idioms with take / make / do / get",
    level:"Advanced",
    explanation:"Common idioms use basic verbs with nouns: make a decision, take responsibility, do research, get permission.",
    ruleRu:"–ß–∞—Å—Ç—ã–µ —Å–ª–æ–≤–æ—Å–æ—á–µ—Ç–∞–Ω–∏—è: make a mistake, take part, do homework, get a chance.",
    formulas:[
      "make a decision",
      "take responsibility",
      "do research",
      "get permission"
    ],
    examples:[
      "He made a serious mistake.",
      "She took responsibility for the project."
    ],
    exercises:[
      {
        title:"Choose the natural collocation",
        questions:[
          {
            text:"—Å–¥–µ–ª–∞—Ç—å —Ä–µ—à–µ–Ω–∏–µ",
            options:[
              "make a decision",
              "do a decision"
            ],
            correct:0
          },
          {
            text:"–ø—Ä–æ–≤–µ—Å—Ç–∏ –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ",
            options:[
              "do research",
              "make research"
            ],
            correct:0
          },
          {
            text:"–ø–æ–ª—É—á–∏—Ç—å —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–µ",
            options:[
              "get permission",
              "take permission"
            ],
            correct:0
          }
        ]
      }
    ]
  },

  {
    id:26,
    title:"Inversion in conditional sentences",
    level:"Advanced",
    explanation:"We can drop if and use inversion with had, were, should in formal conditionals.",
    ruleRu:"Had I known..., Were I you..., Should you need help..., ‚Äì –±–µ–∑ if, —Å –∏–Ω–≤–µ—Ä—Å–∏–µ–π.",
    formulas:[
      "Had I known, I would have helped.",
      "Were I you, I would wait.",
      "Should you need help, call me."
    ],
    examples:[
      "Had I known about the exam, I would have prepared.",
      "Were I you, I would apologise."
    ],
    exercises:[
      {
        title:"Choose the correct inverted conditional",
        questions:[
          {
            text:"–ï—Å–ª–∏ –±—ã —è –∑–Ω–∞–ª, —è –±—ã –ø–æ–º–æ–≥.",
            options:[
              "Had I known, I would have helped.",
              "If had I known, I would have helped."
            ],
            correct:0
          },
          {
            text:"–ï—Å–ª–∏ –±—ã —è –±—ã–ª –Ω–∞ —Ç–≤–æ—ë–º –º–µ—Å—Ç–µ, —è –±—ã –ø–æ–¥–æ–∂–¥–∞–ª.",
            options:[
              "Were I you, I would wait.",
              "If I were you, I would wait were."
            ],
            correct:0
          },
          {
            text:"–ï—Å–ª–∏ –≤–∞–º –ø–æ–Ω–∞–¥–æ–±–∏—Ç—Å—è –ø–æ–º–æ—â—å, –ø–æ–∑–≤–æ–Ω–∏—Ç–µ –º–Ω–µ.",
            options:[
              "Should you need help, call me.",
              "If should you need help, call me."
            ],
            correct:0
          }
        ]
      }
    ]
  },

  {
    id:27,
    title:"Concessive clauses (even if / even though)",
    level:"Advanced",
    explanation:"Concessive clauses show contrast: even though (fact), even if (imaginary).",
    ruleRu:"even though + —Ñ–∞–∫—Ç; even if + –≤–æ–æ–±—Ä–∞–∂–∞–µ–º–∞—è —Å–∏—Ç—É–∞—Ü–∏—è: Even though it was raining, we went out. Even if it rains, we‚Äôll go out.",
    formulas:[
      "Even though + clause",
      "Even if + clause"
    ],
    examples:[
      "Even though he was tired, he continued.",
      "Even if it rains, we will play."
    ],
    exercises:[
      {
        title:"Choose even though or even if",
        questions:[
          {
            text:"___ he was ill, he went to work. (–æ–Ω —Ä–µ–∞–ª—å–Ω–æ –±—ã–ª –±–æ–ª–µ–Ω)",
            options:["Even though","Even if"],
            correct:0
          },
          {
            text:"We‚Äôll go for a walk ___ it rains.",
            options:["even if","even though"],
            correct:0
          },
          {
            text:"___ she apologises, he won‚Äôt forgive her. (–≥–∏–ø–æ—Ç–µ—Ç–∏—á–µ—Å–∫–∏)",
            options:["Even if","Even though"],
            correct:0
          }
        ]
      }
    ]
  },

  {
    id:28,
    title:"Embedded questions",
    level:"Advanced",
    explanation:"Embedded questions keep normal word order, not question order.",
    ruleRu:"–í –∫–æ—Å–≤–µ–Ω–Ω—ã—Ö –≤–æ–ø—Ä–æ—Å–∞—Ö –ø–æ—Ä—è–¥–æ–∫ —Å–ª–æ–≤ –∫–∞–∫ –≤ —É—Ç–≤–µ—Ä–¥–∏—Ç–µ–ª—å–Ω–æ–º: I don‚Äôt know where he is (–ù–ï where is he).",
    formulas:[
      "Can you tell me where he is?",
      "I wonder what she wants."
    ],
    examples:[
      "Do you know where they live?",
      "I‚Äôm not sure what we should do."
    ],
    exercises:[
      {
        title:"Choose the correct embedded question",
        questions:[
          {
            text:"–Ø –Ω–µ –∑–Ω–∞—é, –≥–¥–µ –æ–Ω –∂–∏–≤—ë—Ç.",
            options:[
              "I don‚Äôt know where he lives.",
              "I don‚Äôt know where does he live."
            ],
            correct:0
          },
          {
            text:"–°–∫–∞–∂–∏ –º–Ω–µ, —á—Ç–æ –æ–Ω —Å–∫–∞–∑–∞–ª.",
            options:[
              "Tell me what he said.",
              "Tell me what did he say."
            ],
            correct:0
          },
          {
            text:"–Ø –Ω–µ —É–≤–µ—Ä–µ–Ω–∞, –ø–æ—á–µ–º—É –æ–Ω–∏ —É—à–ª–∏.",
            options:[
              "I‚Äôm not sure why they left.",
              "I‚Äôm not sure why did they leave."
            ],
            correct:0
          }
        ]
      }
    ]
  },

  {
    id:29,
    title:"It- and there-clauses",
    level:"Advanced",
    explanation:"We use introductory it and there to start sentences: It seems that..., There is/are....",
    ruleRu:"It –¥–ª—è –±–µ–∑–ª–∏—á–Ω—ã—Ö –∫–æ–Ω—Å—Ç—Ä—É–∫—Ü–∏–π: It seems that..., It is important to...; there is/are ‚Äì –Ω–∞–ª–∏—á–∏–µ.",
    formulas:[
      "It seems that he is right.",
      "It is difficult to say.",
      "There is a problem.",
      "There are many reasons."
    ],
    examples:[
      "It is important to practise every day.",
      "There are several solutions."
    ],
    exercises:[
      {
        title:"Choose it or there",
        questions:[
          {
            text:"___ is no easy answer.",
            options:["There","It"],
            correct:0
          },
          {
            text:"___ seems that they are late.",
            options:["It","There"],
            correct:0
          },
          {
            text:"___ are three main reasons.",
            options:["There","It"],
            correct:0
          }
        ]
      }
    ]
  },

  {
    id:30,
    title:"Paraphrasing and rewriting",
    level:"Advanced",
    explanation:"Paraphrasing means expressing the same idea with different words and structures.",
    ruleRu:"Paraphrase ‚Äì –ø–µ—Ä–µ—Å–∫–∞–∑ —Å–≤–æ–µ–π —Ñ–æ—Ä–º—É–ª–∏—Ä–æ–≤–∫–æ–π: –∏–∑–º–µ–Ω—è–µ–º –ª–µ–∫—Å–∏–∫—É –∏ –≥—Ä–∞–º–º–∞—Ç–∏–∫—É, —Å–æ—Ö—Ä–∞–Ω—è—è —Å–º—ã—Å–ª.",
    formulas:[
      "use synonyms",
      "change active ‚Üí passive",
      "change clause structure"
    ],
    examples:[
      "The exam was difficult ‚Üí It was a difficult exam.",
      "People believe that ‚Üí It is believed that..."
    ],
    exercises:[
      {
        title:"Choose the best paraphrase",
        questions:[
          {
            text:"People believe that the plan will succeed.",
            options:[
              "It is believed that the plan will succeed.",
              "The plan believes to succeed."
            ],
            correct:0
          },
          {
            text:"They built the bridge in 2010.",
            options:[
              "The bridge was built in 2010.",
              "In 2010 they did the bridge."
            ],
            correct:0
          },
          {
            text:"He is responsible for the project.",
            options:[
              "He is in charge of the project.",
              "He is project responsible."
            ],
            correct:0
          }
        ]
      }
    ]
  }
];

/* ---------- STATE & STORAGE ---------- */

let currentUser = null;   // {name, code, classLabel, stars, lastLogin, attempts:{topicId:true}}
let currentTopicId = null;

function todayStr(){
  return new Date().toISOString().slice(0,10);
}

function studentKey(code){
  // –æ—Ç–¥–µ–ª—å–Ω—ã–π namespace –¥–ª—è Advanced
  return "bayan_adv_student_" + code;
}

function loadStudent(code, name, classLabel){
  const key = studentKey(code);
  let data = null;
  try{
    data = JSON.parse(localStorage.getItem(key));
  }catch(e){
    data = null;
  }
  if(!data){
    data = {
      name: name || "",
      code,
      classLabel,
      stars: 0,
      lastLogin: null,
      attempts: {}
    };
  }else{
    if(name) data.name = name;
    data.classLabel = classLabel;
    if(typeof data.stars !== "number") data.stars = 0;
    if(!data.attempts || typeof data.attempts !== "object"){
      data.attempts = {};
    }
  }
  data.lastLogin = todayStr();
  localStorage.setItem(key, JSON.stringify(data));
  return data;
}

function saveCurrent(){
  if(!currentUser) return;
  const key = studentKey(currentUser.code);
  localStorage.setItem(key, JSON.stringify(currentUser));
}

/* ---------- SCREEN SWITCHING ---------- */

function showOnly(id){
  document.getElementById("loginScreen").classList.add("hidden");
  document.getElementById("mainMenuScreen").classList.add("hidden");
  document.getElementById("topicScreen").classList.add("hidden");
  document.getElementById("teacherScreen").classList.add("hidden");
  document.getElementById(id).classList.remove("hidden");
}

function setTopInfo(html){
  document.getElementById("topInfo").innerHTML = html;
}

/* ---------- LOGIN (teacher code 6678) ---------- */

function handleLogin(){
  const name = document.getElementById("loginName").value.trim();
  const codeStr = document.getElementById("loginCode").value.trim();
  const errorEl = document.getElementById("loginError");

  errorEl.classList.add("hidden");
  errorEl.textContent = "";

  if(!codeStr){
    errorEl.textContent = "Enter your code.";
    errorEl.classList.remove("hidden");
    return;
  }

  // TEACHER
  if(codeStr === "6678"){
    currentUser = null;
    setTopInfo("Logged in as <strong>TEACHER</strong> ¬∑ code 6678");
    renderTeacherTable();
    showOnly("teacherScreen");
    return;
  }

  const num = Number(codeStr);
  if(!Number.isInteger(num)){
    errorEl.textContent = "Code must be a number.";
    errorEl.classList.remove("hidden");
    return;
  }

  const classLabel = getClassByCode(num);
  if(!classLabel){
    errorEl.textContent = "Unknown student code. Ask your teacher.";
    errorEl.classList.remove("hidden");
    return;
  }
  if(!name){
    errorEl.textContent = "Enter your name.";
    errorEl.classList.remove("hidden");
    return;
  }

  currentUser = loadStudent(num, name, classLabel);
  saveCurrent();

  setTopInfo(
    `Class <strong>${currentUser.classLabel}</strong> ¬∑ Student: <strong>${currentUser.name}</strong> (code ${currentUser.code}) ¬∑ Stars: <strong id="topStars">${currentUser.stars}</strong>`
  );

  buildMainMenu();
  updateTopStars();
  showOnly("mainMenuScreen");
}

function backToLogin(){
  currentUser = null;
  setTopInfo("Not logged in");
  document.getElementById("loginName").value = "";
  document.getElementById("loginCode").value = "";
  showOnly("loginScreen");
}

/* ---------- MAIN MENU UI ---------- */

function buildMainMenu(){
  if(!currentUser) return;
  const menuInfo = document.getElementById("menuInfo");
  menuInfo.innerHTML =
    `Class <strong>${currentUser.classLabel}</strong>, student <strong>${currentUser.name}</strong> (code ${currentUser.code})`;

  document.getElementById("menuStars").textContent = currentUser.stars ?? 0;

  const grid = document.getElementById("menuTopics");
  grid.innerHTML = "";

  topics.forEach(t => {
    const div = document.createElement("div");
    div.className = "topic-card";
    const color = topicColors[t.id] || "#ff6f00";
    div.style.borderColor = color + "66";

    div.innerHTML = `
      <div class="topic-card-title">${t.id}. ${t.title}</div>
      <div class="muted">${t.level}</div>
    `;

    div.addEventListener("click", () => openTopic(t.id));
    grid.appendChild(div);
  });
}

/* ---------- TOPIC SCREEN + 1 –ø–æ–ø—ã—Ç–∫–∞ ---------- */

function openTopic(id){
  if(!currentUser) return;
  currentTopicId = id;

  const t = topics.find(x => x.id === id);
  if(!t) return;

  const color = topicColors[id] || "#ff6f00";
  document.documentElement.style.setProperty("--topicColor", color);

  document.getElementById("topicHeaderTitle").textContent = `${id}. ${t.title}`;

  // –ø—Ä–∞–≤–∏–ª–æ
  const rc = document.getElementById("topicRuleContainer");
  rc.innerHTML = "";
  const gbox = document.createElement("div");
  gbox.className = "grammar-box";
  gbox.innerHTML = `
    <strong>Rule (EN):</strong> ${t.explanation || ""}
    ${
      t.formulas && t.formulas.length
        ? "<div style='margin-top:6px;'>" +
          t.formulas.map(f => `<span class="formula">${f}</span>`).join(" ") +
          "</div>"
        : ""
    }
    ${
      t.ruleRu
        ? `<div style="margin-top:8px;font-size:13px;"><strong>–ü—Ä–∞–≤–∏–ª–æ (RU):</strong><br>${t.ruleRu}</div>`
        : ""
    }
  `;
  rc.appendChild(gbox);

  if(t.examples && t.examples.length){
    const ul = document.createElement("ul");
    ul.className = "examples";
    t.examples.forEach(e => {
      const li = document.createElement("li");
      li.textContent = e;
      ul.appendChild(li);
    });
    rc.appendChild(ul);
  }

  // —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—è
  const ec = document.getElementById("topicExercisesContainer");
  ec.innerHTML = "";

  if(!t.exercises || t.exercises.length === 0){
    const p = document.createElement("p");
    p.className = "muted";
    p.style.marginTop = "10px";
    p.textContent = "Exercises for this topic will be added later.";
    ec.appendChild(p);
  }else{
    t.exercises.forEach((ex, exIndex) => {
      const block = document.createElement("div");
      block.className = "exercise-block";

      const title = document.createElement("div");
      title.className = "exercise-title";
      title.textContent = ex.title || `Exercise ${exIndex+1}`;
      block.appendChild(title);

      ex.questions.forEach((q, qIndex) => {
        const row = document.createElement("div");
        row.className = "question-row";

        const qText = document.createElement("div");
        qText.className = "question-text";
        qText.textContent = `${qIndex+1}) ${q.text}`;
        row.appendChild(qText);

        const opts = document.createElement("div");
        opts.className = "options";

        if(q.options && q.options.length){
          q.options.forEach((opt, optIndex) => {
            const label = document.createElement("label");

            const radio = document.createElement("input");
            radio.type = "radio";
            const gname = `t${id}_e${exIndex}_q${qIndex}`;
            radio.name = gname;
            radio.value = optIndex;

            label.appendChild(radio);
            label.appendChild(document.createTextNode(" " + opt));
            opts.appendChild(label);
          });
        }

        row.appendChild(opts);

        const mark = document.createElement("span");
        mark.className = "mark";
        mark.id = `mark_t${id}_e${exIndex}_q${qIndex}`;
        mark.style.width = "18px";
        mark.style.textAlign = "center";
        mark.style.fontSize = "16px";
        mark.style.fontWeight = "700";
        row.appendChild(mark);

        block.appendChild(row);
      });

      const footer = document.createElement("div");
      footer.className = "exercise-footer";

      const small = document.createElement("small");
      small.style.fontSize = "11px";
      small.style.color = "#6b5f55";
      small.textContent = "Each correct answer gives you 1 star. Only ONE attempt for this topic.";
      footer.appendChild(small);

      const btn = document.createElement("button");
      btn.className = "btn btn-primary";
      btn.textContent = "Check";
      btn.addEventListener("click", () => checkExercise(id, exIndex));
      footer.appendChild(btn);

      block.appendChild(footer);
      ec.appendChild(block);
    });
  }

  const status = document.getElementById("topicStatus");
  if(currentUser && currentUser.attempts && currentUser.attempts[id]){
    status.textContent = "You have already used your attempt for this topic.";
  }else{
    status.textContent = "You have 1 attempt for this topic.";
  }

  showOnly("topicScreen");
}

function backToMenu(){
  if(!currentUser){
    backToLogin();
    return;
  }
  buildMainMenu();
  showOnly("mainMenuScreen");
}

/* ---------- CHECK EXERCISE (1 –ø–æ–ø—ã—Ç–∫–∞ –Ω–∞ —Ç–µ–º—É) ---------- */

function checkExercise(topicId, exIndex){
  if(!currentUser) return;

  const status = document.getElementById("topicStatus") || { textContent:"" };

  // –£–∂–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª –ø–æ–ø—ã—Ç–∫—É –¥–ª—è –≤—Å–µ–π —Ç–µ–º—ã?
  if(currentUser.attempts && currentUser.attempts[topicId]){
    status.textContent = "You have already used your attempt for this topic.";
    return;
  }

  const t = topics.find(x => x.id === topicId);
  if(!t) return;
  const ex = t.exercises[exIndex];
  if(!ex) return;

  let gained = 0;

  ex.questions.forEach((q, qIndex) => {
    const gname = `t${topicId}_e${exIndex}_q${qIndex}`;
    const selected = document.querySelector(`input[name="${gname}"]:checked`);
    const markEl = document.getElementById(`mark_t${topicId}_e${exIndex}_q${qIndex}`);

    if(!markEl) return;
    markEl.textContent = "";
    markEl.style.color = "#3a2b1f";

    if(!selected){
      markEl.textContent = "‚Ä¢";
      return;
    }

    const chosen = Number(selected.value);
    if(chosen === q.correct){
      markEl.textContent = "‚úì";
      markEl.style.color = "#2e7d32";
      gained++;
    }else{
      markEl.textContent = "‚úó";
      markEl.style.color = "#c62828";
    }
  });

  // –ø–æ–º–µ—á–∞–µ–º, —á—Ç–æ –ø–æ–ø—ã—Ç–∫–∞ –¥–ª—è —Ç–µ–º—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∞
  if(!currentUser.attempts || typeof currentUser.attempts !== "object"){
    currentUser.attempts = {};
  }
  currentUser.attempts[topicId] = true;

  if(gained > 0){
    currentUser.stars += gained;
    saveCurrent();
    updateTopStars();
    status.textContent = `Well done! You gained ${gained} star(s). Your attempt for this topic is now used.`;
  }else{
    saveCurrent();
    status.textContent = "No correct answers this time. Your attempt for this topic is used.";
  }
}

/* ---------- TEACHER TABLE ---------- */

function renderTeacherTable(){
  const tbody = document.querySelector("#teacherTable tbody");
  tbody.innerHTML = "";

  const allStudents = [];

  classRanges.forEach(r => {
    for(let code = r.from; code <= r.to; code++){
      const key = studentKey(code);
      let data = null;
      try{
        data = JSON.parse(localStorage.getItem(key));
      }catch(e){
        data = null;
      }
      if(data){
        if(!data.attempts || typeof data.attempts !== "object"){
          data.attempts = {};
        }
        allStudents.push(data);
      }
    }
  });

  if(allStudents.length === 0){
    const tr = document.createElement("tr");
    const td = document.createElement("td");
    td.colSpan = 6;
    td.textContent = "No student data in this browser yet.";
    tr.appendChild(td);
    tbody.appendChild(tr);
    return;
  }

  allStudents.sort((a,b) => a.code - b.code);

  allStudents.forEach(s => {
    const tr = document.createElement("tr");

    const clsTd = document.createElement("td");
    clsTd.textContent = s.classLabel || getClassByCode(s.code) || "";
    const codeTd = document.createElement("td");
    codeTd.textContent = s.code;
    const nameTd = document.createElement("td");
    nameTd.textContent = s.name || "";
    const starsTd = document.createElement("td");
    starsTd.textContent = s.stars ?? 0;
    const loginTd = document.createElement("td");
    loginTd.textContent = s.lastLogin || "";

    const attemptsTd = document.createElement("td");
    const cnt = s.attempts ? Object.keys(s.attempts).length : 0;
    attemptsTd.textContent = `${cnt} topic(s)`;

    tr.appendChild(clsTd);
    tr.appendChild(codeTd);
    tr.appendChild(nameTd);
    tr.appendChild(starsTd);
    tr.appendChild(loginTd);
    tr.appendChild(attemptsTd);

    tbody.appendChild(tr);
  });
}

/* ---------- STARS DISPLAY ---------- */

function updateTopStars(){
  if(!currentUser) return;
  const topStarsEl = document.getElementById("topStars");
  if(topStarsEl) topStarsEl.textContent = currentUser.stars;

  const menuStarsEl = document.getElementById("menuStars");
  if(menuStarsEl) menuStarsEl.textContent = currentUser.stars;
}

/* ---------- INIT ---------- */

showOnly("loginScreen");
</script>

</body>
</html>
