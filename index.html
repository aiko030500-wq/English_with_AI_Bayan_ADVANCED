<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>ENGLISH WITH AI BAYAN ‚Äì Advanced</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <style>
    :root{
      --main:#ff6f00;          /* –ù–ê–°–´–©–ï–ù–ù–´–ô –û–†–ê–ù–ñ–ï–í–´–ô */
      --main-dark:#e65100;     /* –¢–ï–ú–ù–´–ô –û–†–ê–ù–ñ–ï–í–´–ô */
      --soft:#ff8f00;          /* –ú–Ø–ì–ö–ò–ô –û–†–ê–ù–ñ–ï–í–´–ô */
      --gold:#ffd54f;
      --bg:#fff9f0;            /* –û–ß–ï–ù–¨ –°–í–ï–¢–õ–´–ô –û–†–ê–ù–ñ–ï–í–´–ô –§–û–ù */
      --topicColor:#ff6f00;
    }

    *{
      box-sizing:border-box;
      margin:0;
      padding:0;
      font-family:system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",sans-serif;
    }

    body{
      background:var(--bg);
      color:#3a2b1f;
    }

    /* HEADER ------------------------------------------------------------ */
    header{
      background:linear-gradient(90deg,var(--main-dark),var(--main));
      color:#fff;
      padding:10px 24px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      box-shadow:0 2px 6px rgba(0,0,0,.25);
    }

    .brand{
      display:flex;
      align-items:center;
      gap:12px;
    }

    .logo-img{
      width:52px;
      height:52px;
      border-radius:50%;
      object-fit:cover;
      border:3px solid var(--gold);
      background:white;
    }

    .brand-text h1{
      font-size:18px;
      letter-spacing:.04em;
    }

    .brand-text span{
      font-size:12px;
      opacity:.9;
    }

    .top-info{
      font-size:13px;
      text-align:right;
    }
    .top-info strong{color:var(--gold);}

    /* MAIN -------------------------------------------------------------- */
    main{
      padding:16px;
      max-width:1300px;
      margin:0 auto;
    }

    .card{
      background:#fff;
      border-radius:14px;
      box-shadow:0 4px 14px rgba(0,0,0,.1);
      padding:20px;
    }

    .hidden{display:none !important;}

    .section-title{
      font-size:18px;
      margin-bottom:10px;
      font-weight:600;
    }
    .muted{
      color:#6b5f55;
      font-size:12px;
    }

    .field-label{
      font-size:14px;
      margin-bottom:4px;
    }

    .text-input{
      width:100%;
      padding:10px 12px;
      border-radius:10px;
      border:1px solid #d6cec7;
      margin-bottom:14px;
      font-size:14px;
      background:#fffdf8;
    }
    .text-input:focus{
      outline:none;
      border-color:var(--soft);
      box-shadow:0 0 0 2px rgba(255,143,0,.25);
    }

    /* BUTTONS ----------------------------------------------------------- */
    .btn{
      border:none;
      border-radius:10px;
      padding:10px 18px;
      font-size:14px;
      font-weight:600;
      cursor:pointer;
      display:inline-flex;
      align-items:center;
      justify-content:center;
      gap:6px;
    }

    .btn-primary{
      background:var(--main);
      color:#fff;
    }
    .btn-primary:hover{background:var(--main-dark);}

    .btn-ghost{
      background:#fff3e0;
      color:var(--main-dark);
    }
    .btn-ghost:hover{
      background:#ffe0b2;
    }

    .error{
      margin-top:10px;
      color:#b00020;
      font-size:13px;
    }

    /* LOGIN ------------------------------------------------------------- */
    #loginScreen{
      max-width:520px;
      margin:40px auto;
    }

    /* MAIN MENU --------------------------------------------------------- */
    #mainMenuScreen{
      display:grid;
      grid-template-columns:2fr 1.2fr;
      gap:16px;
    }
    @media(max-width:960px){
      #mainMenuScreen{
        grid-template-columns:1fr;
      }
    }

    .tag{
      display:inline-block;
      padding:3px 7px;
      border-radius:999px;
      background:#ffe0b2;
      font-size:11px;
      color:var(--main-dark);
    }

    .top-row{
      display:flex;
      justify-content:space-between;
      align-items:center;
      flex-wrap:wrap;
      gap:8px;
      margin-bottom:12px;
    }

    .stars-badge{
      display:inline-flex;
      align-items:center;
      gap:4px;
      padding:4px 8px;
      border-radius:999px;
      background:#fff8e1;
      border:1px solid #ffecb3;
      font-size:12px;
    }
    .star-icon{color:#ffa000;}

    .topics-grid{
      display:grid;
      grid-template-columns:1fr 1fr;
      gap:10px;
    }
    @media(max-width:700px){
      .topics-grid{grid-template-columns:1fr;}
    }

    .topic-card{
      border-radius:12px;
      border:1px solid #ffe0b2;
      padding:10px 12px;
      background:#fffdf7;
      cursor:pointer;
      transition:.15s;
      display:flex;
      flex-direction:column;
      gap:4px;
    }
    .topic-card:hover{
      background:#fff3e0;
      transform:translateY(-1px);
    }

    /* AI PANEL ---------------------------------------------------------- */
    #aiPanel{
      background:#fff;
      border-radius:14px;
      padding:14px;
      box-shadow:0 2px 10px rgba(0,0,0,.07);
      display:flex;
      flex-direction:column;
      gap:8px;
      min-height:260px;
    }

    #aiPanel h3{
      font-size:15px;
      margin-bottom:4px;
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:6px;
    }
    #aiLimit{font-size:11px;}

    .chat-note{
      font-size:11px;
      color:#6b5f55;
    }

    .chat-box{
      flex:1;
      border-radius:10px;
      border:1px solid #ffe0b2;
      padding:8px;
      background:#fffdf7;
      font-size:13px;
      overflow-y:auto;
    }

    #aiQuestion{
      width:100%;
      min-height:60px;
      resize:vertical;
      border-radius:10px;
      border:1px solid #ffe0b2;
      padding:8px;
      background:#fffdf7;
    }

    /* TOPIC SCREEN ------------------------------------------------------ */
    #topicScreen{
      max-width:1000px;
      margin:0 auto;
    }

    .topic-header{
      border-radius:16px 16px 0 0;
      padding:14px 16px;
      background:linear-gradient(90deg,var(--topicColor),var(--main-dark));
      color:#fff;
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:10px;
      flex-wrap:wrap;
    }

    .topic-header-title{
      font-size:18px;
      font-weight:600;
    }

    .topic-header-buttons{
      display:flex;
      gap:6px;
    }

    .btn-topic{
      border:none;
      border-radius:999px;
      padding:6px 12px;
      font-size:12px;
      font-weight:600;
      cursor:pointer;
    }

    .btn-topic.back{
      background:#fff;
      color:var(--topicColor);
    }

    .btn-topic.menu{
      background:rgba(255,255,255,.3);
      color:#fff;
      border:1px solid rgba(255,255,255,.4);
    }

    .topic-body{
      background:#fff;
      border-radius:0 0 16px 16px;
      box-shadow:0 4px 14px rgba(0,0,0,.1);
      padding:16px;
    }

    .grammar-box{
      background:#fff7e6;
      border-left:4px solid var(--topicColor);
      padding:10px 12px;
      border-radius:10px;
      font-size:14px;
    }

    .formula{
      font-family:monospace;
      background:#ffe0b2;
      padding:3px 6px;
      border-radius:6px;
      display:inline-block;
      margin-top:4px;
      margin-right:4px;
    }

    .examples li{
      margin-left:18px;
      margin-bottom:2px;
      font-size:13px;
    }

    /* PRINT MODE -------------------------------------------------------- */
    @media print{
      header, #loginScreen, #mainMenuScreen, #teacherScreen{
        display:none !important;
      }
      body{ background:#fff; }
      #topicScreen{ display:block !important; }
      .topic-body{ box-shadow:none; border-radius:0; }
    }

  </style>
</head>

<body>
<header>
  <div class="brand">
    <img src="logo.png" class="logo-img" alt="">
    <div class="brand-text">
      <h1>ENGLISH WITH AI BAYAN</h1>
      <span>Advanced ¬∑ 30 grammar topics</span>
    </div>
  </div>
  <div class="top-info" id="topInfo">Not logged in</div>
</header>

<main>

  <!-- LOGIN -->
  <section id="loginScreen" class="card">
    <h2 class="section-title">Login</h2>
    <p class="muted">Enter your Name and Code.</p>

    <label class="field-label" for="loginName">Name</label>
    <input id="loginName" class="text-input" type="text" placeholder="Your name">

    <label class="field-label" for="loginCode">Code</label>
    <input id="loginCode" class="text-input" type="password" placeholder="Student or teacher code">

    <div style="display:flex;gap:8px;margin-top:4px">
      <button class="btn btn-primary" onclick="handleLogin()">Login</button>
      <button class="btn btn-ghost" onclick="backToLogin()">Reset</button>
    </div>

    <div id="loginError" class="error hidden"></div>
  </section>

  <!-- MAIN MENU -->
  <section id="mainMenuScreen" class="hidden">
    <section class="card">
      <div class="top-row">
        <div>
          <h2 class="section-title">Advanced grammar topics</h2>
          <div id="menuInfo" class="muted"></div>
        </div>
        <div>
          <span class="stars-badge">
            <span class="star-icon">‚≠ê</span>
            Stars: <span id="menuStars">0</span>
          </span>
        </div>
      </div>

      <div class="topics-grid" id="menuTopics"></div>
    </section>

    <!-- AI PANEL -->
    <aside id="aiPanel">
      <div>
        <h3>
          AI Bayan
          <span id="aiLimit"></span>
        </h3>
        <p class="chat-note">AI chat will be available soon.</p>
      </div>
      <div id="chatBox" class="chat-box"></div>
      <div>
        <textarea id="aiQuestion" disabled placeholder="AI chat is disabled"></textarea>
        <div class="chat-actions">
          <button class="btn btn-primary" id="askBtn" disabled>Ask</button>
        </div>
      </div>
    </aside>
  </section>

  <!-- TOPIC SCREEN -->
  <section id="topicScreen" class="hidden">
    <div class="topic-header">
      <div class="topic-header-title" id="topicHeaderTitle">Topic</div>
      <div class="topic-header-buttons">
        <button class="btn-topic back" onclick="backToMenu()">‚Üê Back</button>
        <button class="btn-topic menu" onclick="backToMenu()">üè†</button>
        <button class="btn-topic menu" onclick="window.print()">üñ®</button>
      </div>
    </div>

    <div class="topic-body">
      <div id="topicRuleContainer"></div>
      <div id="topicExercisesContainer"></div>
      <div id="topicStatus" class="muted"></div>
    </div>
  </section>

  <!-- TEACHER SCREEN -->
  <section id="teacherScreen" class="hidden card">
    <div class="top-buttons">
      <button class="btn btn-ghost" onclick="backToLogin()">‚Üê Back</button>
      <span class="tag">Teacher mode</span>
    </div>

    <h2 class="section-title">Teacher dashboard</h2>
    <p class="muted">Shows attempt status + stars.</p>

    <div class="table-wrapper">
      <table id="teacherTable">
        <thead>
          <tr>
            <th>Class</th>
            <th>Code</th>
            <th>Name</th>
            <th>Stars</th>
            <th>Last login</th>
            <th>Attempts</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>
  </section>

</main>
<script>
/* ---------- CLASS RANGES (PIN) ---------- */

const classRanges = [
  { cls: "3E",  from: 101,  to: 115 },
  { cls: "4G",  from: 201,  to: 215 },
  { cls: "5G",  from: 301,  to: 315 },
  { cls: "5Zh", from: 401,  to: 415 },
  { cls: "6G",  from: 501,  to: 515 },
  { cls: "7B",  from: 601,  to: 615 },
  { cls: "7V",  from: 701,  to: 715 },
  { cls: "8E",  from: 801,  to: 815 },
  { cls: "9Zh", from: 901,  to: 915 },
  { cls: "10A", from: 1001, to: 1015 }
];

function getClassByCode(num){
  for(const r of classRanges){
    if(num >= r.from && num <= r.to) return r.cls;
  }
  return null;
}

/* ---------- TOPIC COLORS (30 —à—Ç—É–∫ –ø–æ–¥ –æ—Ä–∞–Ω–∂–µ–≤—É—é —Ç–µ–º—É) ---------- */

const topicColors = {
  1:"#f4511e",
  2:"#fb8c00",
  3:"#ef6c00",
  4:"#ff7043",
  5:"#ff8f00",
  6:"#ffb300",
  7:"#f57c00",
  8:"#e64a19",
  9:"#ff9100",
  10:"#ff6f00",
  11:"#f9a825",
  12:"#ffb74d",
  13:"#ffa726",
  14:"#ff9800",
  15:"#ffcc80",
  16:"#ffb300",
  17:"#fb8c00",
  18:"#f57c00",
  19:"#ef6c00",
  20:"#e65100",
  21:"#ff7043",
  22:"#ff6f00",
  23:"#ff8f00",
  24:"#ffa000",
  25:"#ffb300",
  26:"#ffca28",
  27:"#ffb74d",
  28:"#ffa726",
  29:"#ff9800",
  30:"#ff6f00"
};

/* ---------- TOPICS (–ü–û–ö–ê –ü–£–°–¢–û, –í –ß–ê–°–¢–ò 3 –ó–ê–ú–ï–ù–ò–ú) ---------- */

const topics = [
  {
    id:1,
    title:"Inversion after negative adverbials",
    level:"Advanced",
    explanation:"We use inversion (auxiliary + subject) after negative or limiting adverbials like never, seldom, rarely, only then, not until to sound more formal or emphatic.",
    ruleRu:"–ü–æ—Å–ª–µ –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã—Ö –∏–ª–∏ –æ–≥—Ä–∞–Ω–∏—á–∏—Ç–µ–ª—å–Ω—ã—Ö –Ω–∞—Ä–µ—á–∏–π (never, seldom, rarely, only then, not until –∏ –¥—Ä.) –∏—Å–ø–æ–ª—å–∑—É–µ–º –∏–Ω–≤–µ—Ä—Å–∏—é: –≤—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–π –≥–ª–∞–≥–æ–ª + –ø–æ–¥–ª–µ–∂–∞—â–µ–µ, —á—Ç–æ–±—ã —É—Å–∏–ª–∏—Ç—å –≤—ã—Å–∫–∞–∑—ã–≤–∞–Ω–∏–µ.",
    formulas:[
      "Never / Rarely / Seldom + AUX + S + V",
      "Not until + clause + AUX + S + V",
      "Only then / only later + AUX + S + V"
    ],
    examples:[
      "Never have I seen such chaos.",
      "Not until he left did she realise her mistake."
    ],
    exercises:[
      {
        title:"1) Affirmative (choose inversion)",
        questions:[
          {
            text:"I have seen such chaos many times.",
            options:[
              "Never have I seen such chaos.",
              "I never have seen such chaos."
            ],
            correct:0
          },
          {
            text:"She realised the truth only then.",
            options:[
              "Only then did she realise the truth.",
              "She realised the truth only then she did."
            ],
            correct:0
          },
          {
            text:"We noticed the problem only after the test.",
            options:[
              "Only after the test did we notice the problem.",
              "After the test only we noticed the problem."
            ],
            correct:0
          },
          {
            text:"I heard such silence before.",
            options:[
              "Never before had I heard such silence.",
              "I had never before heard such silence it."
            ],
            correct:0
          }
        ]
      },
      {
        title:"2) Negative",
        questions:[
          {
            text:"–Ø –Ω–∏–∫–æ–≥–¥–∞ –Ω–µ –ø–æ–Ω–∏–º–∞–ª —ç—Ç—É —Ç–µ–º—É.",
            options:[
              "Never have I understood this topic.",
              "I have never understood this topic it."
            ],
            correct:0
          },
          {
            text:"–û–Ω —Ä–µ–¥–∫–æ –¥–µ–ª–∞–µ—Ç –æ—à–∏–±–∫–∏.",
            options:[
              "Rarely does he make mistakes.",
              "He does rarely make mistakes."
            ],
            correct:0
          },
          {
            text:"–û–Ω–∏ –ø–æ—á—Ç–∏ –Ω–µ –∑–∞–º–µ—á–∞–ª–∏ –æ–ø–∞—Å–Ω–æ—Å—Ç–∏.",
            options:[
              "Hardly did they notice the danger.",
              "They did hardly notice the danger."
            ],
            correct:0
          },
          {
            text:"–ú–∞–ª–æ —è –æ–∂–∏–¥–∞–ª —Ç–∞–∫–æ–≥–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞.",
            options:[
              "Little did I expect such a result.",
              "I did little expect such a result."
            ],
            correct:0
          }
        ]
      },
      {
        title:"3) Questions",
        questions:[
          {
            text:"–°–æ—Å—Ç–∞–≤—å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –≤–æ–ø—Ä–æ—Å: you / ever / see / such a storm?",
            options:[
              "Have you ever seen such a storm?",
              "Ever have you seen such a storm?"
            ],
            correct:0
          },
          {
            text:"–°–æ—Å—Ç–∞–≤—å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –≤–æ–ø—Ä–æ—Å: she / often / arrive / late?",
            options:[
              "Does she often arrive late?",
              "Often does she arrive late?"
            ],
            correct:0
          },
          {
            text:"–°–æ—Å—Ç–∞–≤—å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –≤–æ–ø—Ä–æ—Å: they / rarely / visit / you?",
            options:[
              "Do they rarely visit you?",
              "Rarely do they visit you?"
            ],
            correct:0
          },
          {
            text:"–°–æ—Å—Ç–∞–≤—å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –≤–æ–ø—Ä–æ—Å: he / ever / tell / lies?",
            options:[
              "Does he ever tell lies?",
              "Does he never tell lies?"
            ],
            correct:0
          }
        ]
      },
      {
        title:"4) Word order",
        questions:[
          {
            text:"–í—ã–±–µ—Ä–∏ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –ø–æ—Ä—è–¥–æ–∫ —Å–ª–æ–≤.",
            options:[
              "Not until the end of the lesson did they understand it.",
              "Did they understand it not until the end of the lesson."
            ],
            correct:0
          },
          {
            text:"–í—ã–±–µ—Ä–∏ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –≤–∞—Ä–∏–∞–Ω—Ç.",
            options:[
              "Only then did she start to cry.",
              "She started to cry only then did."
            ],
            correct:0
          },
          {
            text:"–í—ã–±–µ—Ä–∏ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –≤–∞—Ä–∏–∞–Ω—Ç.",
            options:[
              "Never before had I heard this story.",
              "Had I never before heard this story."
            ],
            correct:0
          },
          {
            text:"–í—ã–±–µ—Ä–∏ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –≤–∞—Ä–∏–∞–Ω—Ç.",
            options:[
              "Little did I know about their plan.",
              "I did little know about their plan."
            ],
            correct:0
          }
        ]
      },
      {
        title:"5) Build the sentence (inversion)",
        questions:[
          {
            text:"(–Ω–∏–∫–æ–≥–¥–∞ / —è / –Ω–µ –≤–∏–¥–µ–ª / —Ç–∞–∫–æ–π –≤–∏–¥)",
            options:[
              "Never have I seen such a view.",
              "I have never seen such a view it."
            ],
            correct:0
          },
          {
            text:"(—Ç–æ–ª—å–∫–æ —Ç–æ–≥–¥–∞ / —è / –ø–æ–Ω—è–ª / –æ—à–∏–±–∫—É)",
            options:[
              "Only then did I understand the mistake.",
              "I understood only then did the mistake."
            ],
            correct:0
          },
          {
            text:"(–Ω–µ —Ä–∞–Ω—å—à–µ —á–µ–º / –æ–Ω –ø—Ä–∏—à—ë–ª / –º—ã –Ω–∞—á–∞–ª–∏)",
            options:[
              "Not until he arrived did we start.",
              "We started not until he arrived did."
            ],
            correct:0
          },
          {
            text:"(—Ä–µ–¥–∫–æ / –æ–Ω / –≥–æ–≤–æ—Ä–∏—Ç / –ø—É–±–ª–∏—á–Ω–æ)",
            options:[
              "Rarely does he speak in public.",
              "He rarely does speak in public."
            ],
            correct:0
          }
        ]
      },
      {
        title:"6) Translate into English (with inversion)",
        questions:[
          {
            text:"–ù–∏–∫–æ–≥–¥–∞ —Ä–∞–Ω—å—à–µ —è –Ω–µ –±—ã–ª —Ç–∞–∫ –∑–∞–Ω—è—Ç.",
            options:[
              "Never before have I been so busy.",
              "I have never been so busy before it."
            ],
            correct:0
          },
          {
            text:"–¢–æ–ª—å–∫–æ —Ç–æ–≥–¥–∞ —è –ø–æ–Ω—è–ª, —á—Ç–æ –æ–Ω–∞ –ø—Ä–∞–≤–∞.",
            options:[
              "Only then did I realise that she was right.",
              "I realised only then that she was right did."
            ],
            correct:0
          },
          {
            text:"–†–µ–¥–∫–æ –æ–Ω —Å–æ–≥–ª–∞—à–∞–µ—Ç—Å—è –Ω–∞ —Ç–∞–∫–∏–µ —É—Å–ª–æ–≤–∏—è.",
            options:[
              "Rarely does he agree to such conditions.",
              "He does rarely agree to such conditions."
            ],
            correct:0
          },
          {
            text:"–ú–∞–ª–æ —è –∑–Ω–∞–ª –æ –µ—ë –ø–ª–∞–Ω–∞—Ö.",
            options:[
              "Little did I know about her plans.",
              "I knew little about her plans did."
            ],
            correct:0
          }
        ]
      }
    ]
  },

  {
    id:2,
    title:"Cleft sentences for emphasis",
    level:"Advanced",
    explanation:"Cleft sentences with It is/was and What‚Ä¶ is/was help us emphasise a person, thing, time, place or reason.",
    ruleRu:"Cleft-–ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è –ø–æ–º–æ–≥–∞—é—Ç –ø–æ–¥—á–µ—Ä–∫–Ω—É—Ç—å –≤–∞–∂–Ω—É—é —á–∞—Å—Ç—å: It was John who‚Ä¶, What I need is‚Ä¶. –ò—Å–ø–æ–ª—å–∑—É–µ–º It is/was + X + who/that‚Ä¶ –∏–ª–∏ What + clause + is/was + X.",
    formulas:[
      "It is/was + X + who/that + clause",
      "What + clause + is/was + X"
    ],
    examples:[
      "It was my brother who broke the window.",
      "What I need is a short break."
    ],
    exercises:[
      {
        title:"1) Affirmative",
        questions:[
          {
            text:"–ü–æ–¥—á–µ—Ä–∫–Ω–∏ —á–µ–ª–æ–≤–µ–∫–∞: My brother broke the window.",
            options:[
              "It was my brother who broke the window.",
              "My brother it was who broke the window."
            ],
            correct:0
          },
          {
            text:"–ü–æ–¥—á–µ—Ä–∫–Ω–∏ –æ–±—ä–µ–∫—Ç: I need a short break.",
            options:[
              "What I need is a short break.",
              "It is a short break what I need."
            ],
            correct:0
          },
          {
            text:"–ü–æ–¥—á–µ—Ä–∫–Ω–∏ –º–µ—Å—Ç–æ: We met in London.",
            options:[
              "It was in London that we met.",
              "In London it was that we met."
            ],
            correct:0
          },
          {
            text:"–ü–æ–¥—á–µ—Ä–∫–Ω–∏ –≤—Ä–µ–º—è: I saw her yesterday.",
            options:[
              "It was yesterday that I saw her.",
              "Yesterday it was that I saw her."
            ],
            correct:0
          }
        ]
      },
      {
        title:"2) Negative",
        questions:[
          {
            text:"–ù–µ –º–æ—è –∏–¥–µ—è –ø—Ä–æ–≤–∞–ª–∏–ª–∞—Å—å.",
            options:[
              "It was not my idea that failed.",
              "Not my idea it was that failed."
            ],
            correct:0
          },
          {
            text:"–≠—Ç–æ –±—ã–ª –Ω–µ –î–∂–æ–Ω, –∫—Ç–æ –ø–æ–∑–≤–æ–Ω–∏–ª —Ç–µ–±–µ.",
            options:[
              "It was not John who called you.",
              "It not was John who called you."
            ],
            correct:0
          },
          {
            text:"–ú–Ω–µ –Ω–µ –µ–≥–æ —Ö–∞—Ä–∞–∫—Ç–µ—Ä –Ω–µ –Ω—Ä–∞–≤–∏—Ç—Å—è, –∞ –ø–æ–≤–µ–¥–µ–Ω–∏–µ.",
            options:[
              "What I do not like is his behaviour.",
              "It is his behaviour what I do not like."
            ],
            correct:0
          },
          {
            text:"–Ø —É—à—ë–ª –Ω–µ –∏–∑-–∑–∞ —Ç–µ–±—è.",
            options:[
              "It was not because of you that I left.",
              "Because of you it was not that I left."
            ],
            correct:0
          }
        ]
      },
      {
        title:"3) Questions",
        questions:[
          {
            text:"–°–¥–µ–ª–∞–π –æ–±—â–∏–π –≤–æ–ø—Ä–æ—Å: It was my brother who broke the window.",
            options:[
              "Was it your brother who broke the window?",
              "Did it your brother who broke the window?"
            ],
            correct:0
          },
          {
            text:"–°–¥–µ–ª–∞–π –æ–±—â–∏–π –≤–æ–ø—Ä–æ—Å: It was in London that we met.",
            options:[
              "Was it in London that we met?",
              "Did we in London that met?"
            ],
            correct:0
          },
          {
            text:"–°–¥–µ–ª–∞–π –æ–±—â–∏–π –≤–æ–ø—Ä–æ—Å: What I need is a break.",
            options:[
              "Is a break what you need?",
              "Is what you need a break?"
            ],
            correct:1
          },
          {
            text:"–°–¥–µ–ª–∞–π –æ–±—â–∏–π –≤–æ–ø—Ä–æ—Å: It was yesterday that she called you.",
            options:[
              "Was it yesterday that she called you?",
              "Did it yesterday that she called you?"
            ],
            correct:0
          }
        ]
      },
      {
        title:"4) Word order",
        questions:[
          {
            text:"–í—ã–±–µ—Ä–∏ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ cleft-–ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ.",
            options:[
              "It was the manager who made the decision.",
              "The manager was who made the decision it."
            ],
            correct:0
          },
          {
            text:"–í—ã–±–µ—Ä–∏ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ cleft-–ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ.",
            options:[
              "It was in 2010 that the company was founded.",
              "In 2010 was the company founded it."
            ],
            correct:0
          },
          {
            text:"–í—ã–±–µ—Ä–∏ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ cleft-–ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ.",
            options:[
              "What surprised me was his honesty.",
              "His honesty was what surprised me it."
            ],
            correct:0
          },
          {
            text:"–í—ã–±–µ—Ä–∏ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ cleft-–ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ.",
            options:[
              "What I enjoy most is travelling.",
              "Travelling is what I enjoy most it."
            ],
            correct:0
          }
        ]
      },
      {
        title:"5) Build the sentence",
        questions:[
          {
            text:"–ü–æ–¥—á–µ—Ä–∫–Ω–∏ –≤—Ä–µ–º—è: We met in 2015.",
            options:[
              "It was in 2015 that we met.",
              "In 2015 it was that we met."
            ],
            correct:0
          },
          {
            text:"–ü–æ–¥—á–µ—Ä–∫–Ω–∏ —á–µ–ª–æ–≤–µ–∫–∞: My teacher inspired me.",
            options:[
              "It was my teacher who inspired me.",
              "My teacher was who inspired me."
            ],
            correct:0
          },
          {
            text:"–ü–æ–¥—á–µ—Ä–∫–Ω–∏ –ø—Ä–∏—á–∏–Ω—É: I left because I was ill.",
            options:[
              "It was because I was ill that I left.",
              "Because I was ill it was that I left."
            ],
            correct:0
          },
          {
            text:"–ü–æ–¥—á–µ—Ä–∫–Ω–∏ –æ–±—ä–µ–∫—Ç: I need your help.",
            options:[
              "What I need is your help.",
              "It is your help what I need."
            ],
            correct:0
          }
        ]
      },
      {
        title:"6) Translate into English",
        questions:[
          {
            text:"–ò–º–µ–Ω–Ω–æ –º–∞–º–∞ –ø–æ–º–æ–≥–ª–∞ –º–Ω–µ.",
            options:[
              "It was my mother who helped me.",
              "My mother was who helped me."
            ],
            correct:0
          },
          {
            text:"–¢–æ, —á—Ç–æ –º–Ω–µ –Ω—É–∂–Ω–æ, ‚Äî —ç—Ç–æ –æ—Ç–¥—ã—Ö.",
            options:[
              "What I need is some rest.",
              "That I need is some rest."
            ],
            correct:0
          },
          {
            text:"–ò–º–µ–Ω–Ω–æ –≤ —ç—Ç–æ–º –≥–æ—Ä–æ–¥–µ —è –≤—ã—Ä–æ—Å.",
            options:[
              "It was in this city that I grew up.",
              "In this city I grew up it."
            ],
            correct:0
          },
          {
            text:"–ò–º–µ–Ω–Ω–æ —ç—Ç–∞ –∏–¥–µ—è –∏–∑–º–µ–Ω–∏–ª–∞ –≤—Å—ë.",
            options:[
              "It was this idea that changed everything.",
              "This idea it was that changed everything."
            ],
            correct:0
          }
        ]
      }
    ]
  },

  {
    id:3,
    title:"Mixed conditionals (advanced use)",
    level:"Advanced",
    explanation:"Mixed conditionals connect unreal past actions with present results or unreal present states with unreal past results.",
    ruleRu:"–°–º–µ—à–∞–Ω–Ω—ã–µ —É—Å–ª–æ–≤–Ω—ã–µ —Å–≤—è–∑—ã–≤–∞—é—Ç –Ω–µ—Ä–µ–∞–ª—å–Ω–æ–µ –ø—Ä–æ—à–ª–æ–µ —Å –Ω–∞—Å—Ç–æ—è—â–∏–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–º (If + Past Perfect ‚Üí would + V now) –∏–ª–∏ –Ω–µ—Ä–µ–∞–ª—å–Ω–æ–µ –Ω–∞—Å—Ç–æ—è—â–µ–µ —Å –Ω–µ—Ä–µ–∞–ª—å–Ω—ã–º –ø—Ä–æ—à–ª—ã–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–º (If + Past Simple ‚Üí would have + V3).",
    formulas:[
      "If + Past Perfect, would + V (now)",
      "If + Past Simple, would have + V3"
    ],
    examples:[
      "If I had studied harder, I would be at university now.",
      "If she were more careful, she would not have lost the documents."
    ],
    exercises:[
      {
        title:"1) Affirmative",
        questions:[
          {
            text:"(–ø—Ä–æ—à–ª–æ–µ ‚Üí —Å–µ–π—á–∞—Å) –Ø –Ω–µ –∫–æ–ø–∏–ª –¥–µ–Ω—å–≥–∏ / —Å–µ–π—á–∞—Å —è –Ω–µ –≤ –ø—É—Ç–µ—à–µ—Å—Ç–≤–∏–∏.",
            options:[
              "If I had saved more money, I would be travelling now.",
              "If I saved more money, I would travel now."
            ],
            correct:0
          },
          {
            text:"(–Ω–∞—Å—Ç–æ—è—â–µ–µ ‚Üí –ø—Ä–æ—à–ª–æ–µ) –û–Ω –Ω–µ–æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã–π / –æ–Ω –ø—Ä–æ–ø—É—Å—Ç–∏–ª –¥–µ–¥–ª–∞–π–Ω.",
            options:[
              "If he were more responsible, he would not have missed the deadline.",
              "If he had been more responsible, he would not miss the deadline."
            ],
            correct:0
          },
          {
            text:"–í—ã–±–µ—Ä–∏ –ø—Ä–∞–≤–∏–ª—å–Ω–æ.",
            options:[
              "If she had gone to bed earlier, she would not be so tired now.",
              "If she went to bed earlier, she would not have been so tired now."
            ],
            correct:0
          },
          {
            text:"–í—ã–±–µ—Ä–∏ –ø—Ä–∞–≤–∏–ª—å–Ω–æ.",
            options:[
              "If I had listened to you, I would not be in trouble now.",
              "If I listened to you, I would not have been in trouble now."
            ],
            correct:0
          }
        ]
      },
      {
        title:"2) Negative",
        questions:[
          {
            text:"–ï—Å–ª–∏ –±—ã –æ–Ω –Ω–µ —Ç—Ä–∞—Ç–∏–ª –≤—Ä–µ–º—è, —Å–µ–π—á–∞—Å –æ–Ω –Ω–µ –±—ã–ª –±—ã —Ç–∞–∫ –Ω–∞–ø—Ä—è–∂—ë–Ω.",
            options:[
              "If he had not wasted time, he would not be so stressed now.",
              "If he did not waste time, he would not have been so stressed now."
            ],
            correct:0
          },
          {
            text:"–ï—Å–ª–∏ –±—ã —è –Ω–µ –±—ã–ª —Ç–∞–∫–∏–º –∑–∞—Å—Ç–µ–Ω—á–∏–≤—ã–º, —è –±—ã –ø–æ–≥–æ–≤–æ—Ä–∏–ª —Å –Ω–µ–π –Ω–∞ –≤–µ—á–µ—Ä–∏–Ω–∫–µ.",
            options:[
              "If I were not so shy, I would have talked to her at the party.",
              "If I had not been so shy, I would talk to her at the party."
            ],
            correct:0
          },
          {
            text:"–ï—Å–ª–∏ –±—ã –æ–Ω–∏ –Ω–µ –ø–µ—Ä–µ–µ—Ö–∞–ª–∏, –º—ã –≤—Å—ë –µ—â—ë —á–∞—Å—Ç–æ –≤—Å—Ç—Ä–µ—á–∞–ª–∏—Å—å –±—ã —Å –Ω–∏–º–∏ —Å–µ–π—á–∞—Å.",
            options:[
              "If they had not moved abroad, we would still see them often now.",
              "If they did not move abroad, we would have still seen them often now."
            ],
            correct:0
          },
          {
            text:"–ï—Å–ª–∏ –±—ã –æ–Ω–∞ –Ω–µ –∑–∞–±–æ–ª–µ–ª–∞, –æ–Ω–∞ –±—ã –ø–æ–µ—Ö–∞–ª–∞ –≤ –ø–æ–µ–∑–¥–∫—É.",
            options:[
              "If she had not been ill, she would have gone on the trip.",
              "If she were not ill, she would have gone on the trip."
            ],
            correct:0
          }
        ]
      },
      {
        title:"3) Questions",
        questions:[
          {
            text:"–ï—Å–ª–∏ –±—ã —è —Å–ª—É—à–∞–ª —Ç–µ–±—è, —Å–µ–π—á–∞—Å —è –±—ã–ª –±—ã —Å—á–∞—Å—Ç–ª–∏–≤–µ–µ.",
            options:[
              "Would you be happier now if you had listened to me?",
              "Would you be happier now if you listened to me?"
            ],
            correct:0
          },
          {
            text:"–ï—Å–ª–∏ –±—ã –æ–Ω –±–æ–ª—å—à–µ —É—á–∏–ª—Å—è, —Å–µ–π—á–∞—Å –æ–Ω –±—ã–ª –±—ã –≤ —É–Ω–∏–≤–µ—Ä—Å–∏—Ç–µ—Ç–µ.",
            options:[
              "Would he be at university now if he had studied harder?",
              "Would he be at university now if he studied harder?"
            ],
            correct:0
          },
          {
            text:"–ï—Å–ª–∏ –±—ã –æ–Ω–∞ –±—ã–ª–∞ –∞–∫–∫—É—Ä–∞—Ç–Ω–µ–µ, –æ–Ω–∞ –Ω–µ –ø–æ—Ç–µ—Ä—è–ª–∞ –±—ã –¥–æ–∫—É–º–µ–Ω—Ç—ã.",
            options:[
              "Would she have lost the documents if she were more careful?",
              "Would she lose the documents if she had been more careful?"
            ],
            correct:0
          },
          {
            text:"–ï—Å–ª–∏ –±—ã –º—ã –∂–∏–ª–∏ –±–ª–∏–∂–µ, —Ä–∞–Ω—å—à–µ –º—ã –±—ã –Ω–µ –æ–ø–∞–∑–¥—ã–≤–∞–ª–∏ —Ç–∞–∫ —á–∞—Å—Ç–æ.",
            options:[
              "Would we have been late so often before if we lived closer?",
              "Would we be late so often before if we had lived closer?"
            ],
            correct:0
          }
        ]
      },
      {
        title:"4) Word order",
        questions:[
          {
            text:"–í—ã–±–µ—Ä–∏ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –ø–æ—Ä—è–¥–æ–∫ —Å–ª–æ–≤.",
            options:[
              "If I had known about the meeting, I would be there now.",
              "If I had known about the meeting, would be there now I."
            ],
            correct:0
          },
          {
            text:"–í—ã–±–µ—Ä–∏ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –ø–æ—Ä—è–¥–æ–∫ —Å–ª–æ–≤.",
            options:[
              "If she were more flexible, she would have accepted the new rules.",
              "If more flexible she were, she would have accepted the new rules."
            ],
            correct:0
          },
          {
            text:"–í—ã–±–µ—Ä–∏ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –ø–æ—Ä—è–¥–æ–∫ —Å–ª–æ–≤.",
            options:[
              "If they had not sold the car, they would be using it now.",
              "If they had not sold the car, would be using it they now."
            ],
            correct:0
          },
          {
            text:"–í—ã–±–µ—Ä–∏ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –ø–æ—Ä—è–¥–æ–∫ —Å–ª–æ–≤.",
            options:[
              "If I had taken that job, I would be living abroad now.",
              "If I had taken that job, would be living abroad now I."
            ],
            correct:0
          }
        ]
      },
      {
        title:"5) Build the sentence",
        questions:[
          {
            text:"–ñ–∞–ª—å, —á—Ç–æ —è –Ω–µ –≤—ã—É—á–∏–ª –∞–Ω–≥–ª–∏–π—Å–∫–∏–π —Ä–∞–Ω—å—à–µ / —Å–µ–π—á–∞—Å –±—ã–ª–æ –±—ã –ª–µ–≥—á–µ.",
            options:[
              "If I had learnt English earlier, it would be easier now.",
              "If I learnt English earlier, it would have been easier now."
            ],
            correct:0
          },
          {
            text:"–ï—Å–ª–∏ –±—ã –æ–Ω –±—ã–ª –æ—Å—Ç–æ—Ä–æ–∂–Ω–µ–µ, –æ–Ω –±—ã –Ω–µ –ø–æ–ø–∞–ª –≤ –∞–≤–∞—Ä–∏—é –≤—á–µ—Ä–∞.",
            options:[
              "If he had been more careful, he would not have had an accident yesterday.",
              "If he were more careful, he would not have an accident yesterday."
            ],
            correct:0
          },
          {
            text:"–ï—Å–ª–∏ –±—ã —è –Ω–µ –ø–æ—Ç—Ä–∞—Ç–∏–ª —Å—Ç–æ–ª—å–∫–æ –¥–µ–Ω–µ–≥, —Å–µ–π—á–∞—Å —è –±—ã–ª –±—ã –±–æ–≥–∞—á–µ.",
            options:[
              "If I had not spent so much money, I would be richer now.",
              "If I did not spend so much money, I would have been richer now."
            ],
            correct:0
          },
          {
            text:"–ï—Å–ª–∏ –±—ã –æ–Ω–∞ –±—ã–ª–∞ —É–≤–µ—Ä–µ–Ω–Ω–µ–µ, –æ–Ω–∞ –±—ã –ø—Ä–∏–Ω—è–ª–∞ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ –≤ –ø—Ä–æ—à–ª–æ–º –≥–æ–¥—É.",
            options:[
              "If she were more confident, she would have accepted the offer last year.",
              "If she had been more confident, she would accept the offer last year."
            ],
            correct:0
          }
        ]
      },
      {
        title:"6) Translate into English",
        questions:[
          {
            text:"–ï—Å–ª–∏ –±—ã —è –±–æ–ª—å—à–µ —Ä–∞–±–æ—Ç–∞–ª –≤ —à–∫–æ–ª–µ, —Å–µ–π—á–∞—Å –º–Ω–µ –±—ã–ª–æ –±—ã –ª–µ–≥—á–µ –≤ —É–Ω–∏–≤–µ—Ä—Å–∏—Ç–µ—Ç–µ.",
            options:[
              "If I had worked harder at school, it would be easier for me at university now.",
              "If I worked harder at school, it would have been easier for me at university now."
            ],
            correct:0
          },
          {
            text:"–ï—Å–ª–∏ –±—ã –æ–Ω –±—ã–ª –±–æ–ª–µ–µ —Ç–µ—Ä–ø–µ–ª–∏–≤—ã–º, –æ–Ω –±—ã –Ω–µ –Ω–∞–∫—Ä–∏—á–∞–ª –Ω–∞ –Ω–µ—ë –≤—á–µ—Ä–∞.",
            options:[
              "If he were more patient, he would not have shouted at her yesterday.",
              "If he had been more patient, he would not shout at her yesterday."
            ],
            correct:0
          },
          {
            text:"–ï—Å–ª–∏ –±—ã –æ–Ω–∏ –Ω–µ —É–µ—Ö–∞–ª–∏ –∑–∞ –≥—Ä–∞–Ω–∏—Ü—É, –º—ã –±—ã —Å–µ–π—á–∞—Å —á–∞—Å—Ç–æ —Å –Ω–∏–º–∏ –≤—Å—Ç—Ä–µ—á–∞–ª–∏—Å—å.",
            options:[
              "If they had not moved abroad, we would be meeting them often now.",
              "If they did not move abroad, we would have met them often now."
            ],
            correct:0
          },
          {
            text:"–ï—Å–ª–∏ –±—ã –º—ã –Ω–µ –ø–æ—Ç—Ä–∞—Ç–∏–ª–∏ —Å—Ç–æ–ª—å–∫–æ –¥–µ–Ω–µ–≥, —Å–µ–π—á–∞—Å —É –Ω–∞—Å –±—ã–ª–æ –±—ã –±–æ–ª—å—à–µ —Å–≤–æ–±–æ–¥—ã.",
            options:[
              "If we had not spent so much money, we would have more freedom now.",
              "If we did not spend so much money, we would have had more freedom now."
            ],
            correct:0
          }
        ]
      }
    ]
  },

  {
    id:4,
    title:"Modal verbs of deduction (present & past)",
    level:"Advanced",
    explanation:"We use must, might, may, could and can‚Äôt to talk about how sure we are about something (deduction) in the present and the past.",
    ruleRu:"Must / can‚Äôt / might / may / could ‚Äì –º–æ–¥–∞–ª—å–Ω—ã–µ –≥–ª–∞–≥–æ–ª—ã –¥–ª—è –ø—Ä–µ–¥–ø–æ–ª–æ–∂–µ–Ω–∏–π: must ‚Äì –ø–æ—á—Ç–∏ —É–≤–µ—Ä–µ–Ω—ã, can‚Äôt ‚Äì —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ –Ω–µ–≤–æ–∑–º–æ–∂–Ω–æ; might/may/could ‚Äì –≤–æ–∑–º–æ–∂–Ω–æ. –î–ª—è –ø—Ä–æ—à–ª–æ–≥–æ –¥–æ–±–∞–≤–ª—è–µ–º have + V3.",
    formulas:[
      "must + V / must have + V3",
      "can‚Äôt + V / can‚Äôt have + V3",
      "might/may/could + V / might/may/could have + V3"
    ],
    examples:[
      "He must be at home ‚Äì the lights are on.",
      "She can‚Äôt have finished already ‚Äì it was too difficult."
    ],
    exercises:[
      {
        title:"1) Affirmative (present)",
        questions:[
          {
            text:"The lights are on. He ___ be at home.",
            options:[
              "must",
              "can‚Äôt"
            ],
            correct:0
          },
          {
            text:"They left very early. They ___ be tired now.",
            options:[
              "must",
              "might not"
            ],
            correct:0
          },
          {
            text:"It‚Äôs dark and cloudy. It ___ rain later.",
            options:[
              "might",
              "can‚Äôt"
            ],
            correct:0
          },
          {
            text:"She studied a lot. She ___ know the answer.",
            options:[
              "must",
              "couldn‚Äôt"
            ],
            correct:0
          }
        ]
      },
      {
        title:"2) Negative / impossibility",
        questions:[
          {
            text:"He is only 10. He ___ be at university.",
            options:[
              "can‚Äôt",
              "must"
            ],
            correct:0
          },
          {
            text:"The room is empty. They ___ be here now.",
            options:[
              "can‚Äôt",
              "must"
            ],
            correct:0
          },
          {
            text:"She never studies. She ___ be the best student.",
            options:[
              "can‚Äôt",
              "must"
            ],
            correct:0
          },
          {
            text:"It‚Äôs July and very hot. It ___ be snow.",
            options:[
              "can‚Äôt",
              "might"
            ],
            correct:0
          }
        ]
      },
      {
        title:"3) Past deduction",
        questions:[
          {
            text:"His phone is off. He ___ have forgotten to charge it.",
            options:[
              "must",
              "must have"
            ],
            correct:1
          },
          {
            text:"The road is dry. It ___ have rained last night.",
            options:[
              "can‚Äôt",
              "can‚Äôt have"
            ],
            correct:1
          },
          {
            text:"She looked very happy yesterday. She ___ have got good news.",
            options:[
              "might have",
              "can‚Äôt have"
            ],
            correct:0
          },
          {
            text:"He doesn‚Äôt know about the meeting. He ___ have read the email.",
            options:[
              "can‚Äôt have",
              "must have"
            ],
            correct:0
          }
        ]
      },
      {
        title:"4) Word order",
        questions:[
          {
            text:"–í—ã–±–µ—Ä–∏ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –≤–∞—Ä–∏–∞–Ω—Ç.",
            options:[
              "He must have forgotten his keys.",
              "He have must forgotten his keys."
            ],
            correct:0
          },
          {
            text:"–í—ã–±–µ—Ä–∏ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –≤–∞—Ä–∏–∞–Ω—Ç.",
            options:[
              "She can‚Äôt have finished already.",
              "She have can‚Äôt finished already."
            ],
            correct:0
          },
          {
            text:"–í—ã–±–µ—Ä–∏ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –≤–∞—Ä–∏–∞–Ω—Ç.",
            options:[
              "They might be waiting outside.",
              "They be might waiting outside."
            ],
            correct:0
          },
          {
            text:"–í—ã–±–µ—Ä–∏ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –≤–∞—Ä–∏–∞–Ω—Ç.",
            options:[
              "It may have been a mistake.",
              "It have may been a mistake."
            ],
            correct:0
          }
        ]
      },
      {
        title:"5) Build the sentence",
        questions:[
          {
            text:"–ù–∞–≤–µ—Ä–Ω—è–∫–∞ –æ–Ω –¥–æ–º–∞ (–≤–∏–¥–µ–Ω –µ–≥–æ –≤–µ–ª–æ—Å–∏–ø–µ–¥).",
            options:[
              "He must be at home.",
              "He can‚Äôt be at home."
            ],
            correct:0
          },
          {
            text:"–≠—Ç–æ–≥–æ –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å (—ç—Ç–æ –Ω–µ–≤–æ–∑–º–æ–∂–Ω–æ).",
            options:[
              "It can‚Äôt be true.",
              "It must be true."
            ],
            correct:0
          },
          {
            text:"–í–æ–∑–º–æ–∂–Ω–æ, –æ–Ω–∞ –∑–∞–±—ã–ª–∞ –ø—Ä–æ –≤—Å—Ç—Ä–µ—á—É.",
            options:[
              "She might have forgotten about the meeting.",
              "She must have forgotten about the meeting."
            ],
            correct:0
          },
          {
            text:"–û–Ω —Ç–æ—á–Ω–æ –Ω–µ —Å–¥–µ–ª–∞–ª –¥–æ–º–∞—à–Ω–µ–µ –∑–∞–¥–∞–Ω–∏–µ.",
            options:[
              "He can‚Äôt have done his homework.",
              "He mustn‚Äôt have done his homework."
            ],
            correct:0
          }
        ]
      },
      {
        title:"6) Translate into English",
        questions:[
          {
            text:"–û–Ω –Ω–∞–≤–µ—Ä–Ω—è–∫–∞ —É—Å—Ç–∞–ª (–æ–Ω —Ä–∞–±–æ—Ç–∞–ª –≤–µ—Å—å –¥–µ–Ω—å).",
            options:[
              "He must be tired.",
              "He can‚Äôt be tired."
            ],
            correct:0
          },
          {
            text:"–û–Ω–∞ –Ω–∞–≤–µ—Ä–Ω—è–∫–∞ —É–∂–µ —É—à–ª–∞ –¥–æ–º–æ–π.",
            options:[
              "She must have gone home.",
              "She can‚Äôt have gone home."
            ],
            correct:0
          },
          {
            text:"–≠—Ç–æ–≥–æ –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å ‚Äî –æ–Ω —Å–ª–∏—à–∫–æ–º —á–µ—Å—Ç–Ω—ã–π.",
            options:[
              "It can‚Äôt be true ‚Äì he is too honest.",
              "It must be true ‚Äì he is too honest."
            ],
            correct:0
          },
          {
            text:"–í–æ–∑–º–æ–∂–Ω–æ, –æ–Ω–∏ –æ–ø–æ–∑–¥–∞–ª–∏ –Ω–∞ –∞–≤—Ç–æ–±—É—Å.",
            options:[
              "They might have missed the bus.",
              "They must have missed the bus."
            ],
            correct:0
          }
        ]
      }
    ]
  },

  {
    id:5,
    title:"Wishes and regrets (I wish / If only / would rather)",
    level:"Advanced",
    explanation:"We use I wish / If only to talk about regrets and unreal wishes about the present, past or future. We use would rather to express preference.",
    ruleRu:"I wish / If only + Past Simple ‚Äì —Å–æ–∂–∞–ª–µ–Ω–∏–µ –æ –Ω–∞—Å—Ç–æ—è—â–µ–º; I wish / If only + Past Perfect ‚Äì —Å–æ–∂–∞–ª–µ–Ω–∏–µ –æ –ø—Ä–æ—à–ª–æ–º; I wish + would ‚Äì –∂–µ–ª–∞–Ω–∏–µ, —á—Ç–æ–±—ã –∫—Ç–æ-—Ç–æ –∏–∑–º–µ–Ω–∏–ª –ø–æ–≤–µ–¥–µ–Ω–∏–µ; would rather ‚Äì –ø—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏–µ.",
    formulas:[
      "I wish / If only + Past Simple (now)",
      "I wish / If only + Past Perfect (past)",
      "I wish + would + V",
      "would rather + V / would rather + S + Past Simple"
    ],
    examples:[
      "I wish I spoke English better.",
      "If only I had studied harder.",
      "I wish you would stop shouting.",
      "I would rather stay at home."
    ],
    exercises:[
      {
        title:"1) Affirmative",
        questions:[
          {
            text:"–ú–Ω–µ –∂–∞–ª—å, —á—Ç–æ —É –º–µ–Ω—è –Ω–µ—Ç –±–æ–ª—å—à–µ —Å–≤–æ–±–æ–¥–Ω–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏.",
            options:[
              "I wish I had more free time.",
              "I wish I have more free time."
            ],
            correct:0
          },
          {
            text:"–ñ–∞–ª—å, —á—Ç–æ —è –Ω–µ –∂–∏–≤—É —É –º–æ—Ä—è.",
            options:[
              "If only I lived by the sea.",
              "If only I live by the sea."
            ],
            correct:0
          },
          {
            text:"–ñ–∞–ª—å, —á—Ç–æ –≤—á–µ—Ä–∞ —è –Ω–µ –±—ã–ª –≤–Ω–∏–º–∞—Ç–µ–ª—å–Ω–µ–µ.",
            options:[
              "I wish I had been more careful yesterday.",
              "I wish I was more careful yesterday."
            ],
            correct:0
          },
          {
            text:"–Ø –ø—Ä–µ–¥–ø–æ—á—ë–ª –±—ã –æ—Å—Ç–∞—Ç—å—Å—è –¥–æ–º–∞ —Å–µ–≥–æ–¥–Ω—è.",
            options:[
              "I would rather stay at home today.",
              "I would rather to stay at home today."
            ],
            correct:0
          }
        ]
      },
      {
        title:"2) Negative",
        questions:[
          {
            text:"–ú–Ω–µ –Ω–µ –∂–∞–ª—å, —á—Ç–æ —è –Ω–µ –∫—É–ø–∏–ª —Ç—É –º–∞—à–∏–Ω—É. (–≤—ã–±–µ—Ä–∏ –Ω–µ–≤–µ—Ä–Ω–æ–µ —Å–æ–∂–∞–ª–µ–Ω–∏–µ)",
            options:[
              "I wish I had bought that car.",
              "I don‚Äôt wish I had bought that car."
            ],
            correct:1
          },
          {
            text:"–í—ã–±–µ—Ä–∏ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ, –ö–û–¢–û–†–û–ï –ù–ï –ü–û–î–•–û–î–ò–¢ –∫–∞–∫ —Å–æ–∂–∞–ª–µ–Ω–∏–µ –æ –ø—Ä–æ—à–ª–æ–º.",
            options:[
              "If only I had told her the truth.",
              "If only I tell her the truth."
            ],
            correct:1
          },
          {
            text:"–í—ã–±–µ—Ä–∏ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –≤–∞—Ä–∏–∞–Ω—Ç.",
            options:[
              "I wish I didn‚Äôt have so much homework.",
              "I wish I don‚Äôt have so much homework."
            ],
            correct:1
          },
          {
            text:"–í—ã–±–µ—Ä–∏ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –≤–∞—Ä–∏–∞–Ω—Ç.",
            options:[
              "If only he wouldn‚Äôt shout so much.",
              "If only he doesn‚Äôt shout so much."
            ],
            correct:1
          }
        ]
      },
      {
        title:"3) Questions",
        questions:[
          {
            text:"–°–¥–µ–ª–∞–π –≤–æ–ø—Ä–æ—Å: You regret that you didn‚Äôt study harder.",
            options:[
              "Do you wish you had studied harder?",
              "Do you wish you studied harder?"
            ],
            correct:0
          },
          {
            text:"–°–¥–µ–ª–∞–π –≤–æ–ø—Ä–æ—Å: You regret your friend‚Äôs behaviour.",
            options:[
              "Do you wish he would behave better?",
              "Do you wish he behaves better?"
            ],
            correct:0
          },
          {
            text:"–°–¥–µ–ª–∞–π –≤–æ–ø—Ä–æ—Å: You prefer to stay at home.",
            options:[
              "Would you rather stay at home?",
              "Would you rather to stay at home?"
            ],
            correct:0
          },
          {
            text:"–°–¥–µ–ª–∞–π –≤–æ–ø—Ä–æ—Å: You regret not telling her the truth.",
            options:[
              "Do you wish you had told her the truth?",
              "Do you wish you told her the truth?"
            ],
            correct:0
          }
        ]
      },
      {
        title:"4) Word order",
        questions:[
          {
            text:"–í—ã–±–µ—Ä–∏ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –ø–æ—Ä—è–¥–æ–∫ —Å–ª–æ–≤.",
            options:[
              "I wish I knew the answer.",
              "I wish knew I the answer."
            ],
            correct:0
          },
          {
            text:"–í—ã–±–µ—Ä–∏ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –ø–æ—Ä—è–¥–æ–∫ —Å–ª–æ–≤.",
            options:[
              "If only I had listened to you.",
              "If only had I listened to you."
            ],
            correct:0
          },
          {
            text:"–í—ã–±–µ—Ä–∏ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –ø–æ—Ä—è–¥–æ–∫ —Å–ª–æ–≤.",
            options:[
              "I would rather you stayed here.",
              "I would rather stayed you here."
            ],
            correct:0
          },
          {
            text:"–í—ã–±–µ—Ä–∏ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –ø–æ—Ä—è–¥–æ–∫ —Å–ª–æ–≤.",
            options:[
              "I wish he would stop talking.",
              "I wish would he stop talking."
            ],
            correct:0
          }
        ]
      },
      {
        title:"5) Build the sentence",
        questions:[
          {
            text:"–ñ–∞–ª—å, —á—Ç–æ —Å–µ–π—á–∞—Å –Ω–µ –ª–µ—Ç–æ.",
            options:[
              "I wish it was summer now.",
              "I wish it had been summer now."
            ],
            correct:0
          },
          {
            text:"–ñ–∞–ª—å, —á—Ç–æ –≤—á–µ—Ä–∞ —è –Ω–µ –ø–æ–¥–≥–æ—Ç–æ–≤–∏–ª—Å—è –∫ —Ç–µ—Å—Ç—É.",
            options:[
              "If only I had prepared for the test yesterday.",
              "If only I prepared for the test yesterday."
            ],
            correct:0
          },
          {
            text:"–Ø –±—ã –ø—Ä–µ–¥–ø–æ—á—ë–ª –ø–æ–π—Ç–∏ –≤ –∫–∏–Ω–æ.",
            options:[
              "I would rather go to the cinema.",
              "I would rather to go to the cinema."
            ],
            correct:0
          },
          {
            text:"–ñ–∞–ª—å, —á—Ç–æ –æ–Ω —Ç–∞–∫ –º–Ω–æ–≥–æ –∂–∞–ª—É–µ—Ç—Å—è.",
            options:[
              "I wish he wouldn‚Äôt complain so much.",
              "I wish he doesn‚Äôt complain so much."
            ],
            correct:0
          }
        ]
      },
      {
        title:"6) Translate into English",
        questions:[
          {
            text:"–ñ–∞–ª—å, —á—Ç–æ —è –Ω–µ –≤—ã—É—á–∏–ª –∞–Ω–≥–ª–∏–π—Å–∫–∏–π —Ä–∞–Ω—å—à–µ.",
            options:[
              "I wish I had learnt English earlier.",
              "I wish I learnt English earlier."
            ],
            correct:0
          },
          {
            text:"–ñ–∞–ª—å, —á—Ç–æ —Å–µ–π—á–∞—Å —É –º–µ–Ω—è –Ω–µ—Ç –±–æ–ª—å—à–µ –≤—Ä–µ–º–µ–Ω–∏.",
            options:[
              "If only I had more time now.",
              "If only I have more time now."
            ],
            correct:0
          },
          {
            text:"–Ø –ø—Ä–µ–¥–ø–æ—á—ë–ª –±—ã, —á—Ç–æ–±—ã —Ç—ã –æ—Å—Ç–∞–ª—Å—è –¥–æ–º–∞.",
            options:[
              "I would rather you stayed at home.",
              "I would rather you stay at home now."
            ],
            correct:0
          },
          {
            text:"–ñ–∞–ª—å, —á—Ç–æ –æ–Ω –Ω–µ —Å–ª—É—à–∞–ª –Ω–∞—Å –≤—á–µ—Ä–∞.",
            options:[
              "I wish he had listened to us yesterday.",
              "I wish he listened to us yesterday."
            ],
            correct:0
          }
        ]
      }
    ]
  }
];

/* ---------- STATE & STORAGE ---------- */

let currentUser = null;   // {name, code, classLabel, stars, lastLogin, attempts:{}}
let currentTopicId = null;

function todayStr(){
  return new Date().toISOString().slice(0,10);
}

function studentKey(code){
  // –æ—Ç–¥–µ–ª—å–Ω—ã–π namespace –¥–ª—è Advanced
  return "bayan_adv_student_" + code;
}

function loadStudent(code, name, classLabel){
  const key = studentKey(code);
  let data = null;
  try{
    data = JSON.parse(localStorage.getItem(key));
  }catch(e){
    data = null;
  }
  if(!data){
    data = {
      name: name || "",
      code,
      classLabel,
      stars: 0,
      lastLogin: null,
      attempts: {} // topicId: true (–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∞ 1 –ø–æ–ø—ã—Ç–∫–∞)
    };
  }else{
    if(name) data.name = name;
    data.classLabel = classLabel;
    if(typeof data.stars !== "number") data.stars = 0;
    if(!data.attempts || typeof data.attempts !== "object"){
      data.attempts = {};
    }
  }
  data.lastLogin = todayStr();
  localStorage.setItem(key, JSON.stringify(data));
  return data;
}

function saveCurrent(){
  if(!currentUser) return;
  const key = studentKey(currentUser.code);
  localStorage.setItem(key, JSON.stringify(currentUser));
}

/* ---------- SCREEN SWITCHING ---------- */

function showOnly(id){
  document.getElementById("loginScreen").classList.add("hidden");
  document.getElementById("mainMenuScreen").classList.add("hidden");
  document.getElementById("topicScreen").classList.add("hidden");
  document.getElementById("teacherScreen").classList.add("hidden");
  document.getElementById(id).classList.remove("hidden");
}

function setTopInfo(html){
  document.getElementById("topInfo").innerHTML = html;
}

/* ---------- LOGIN (teacher code 6678) ---------- */

function handleLogin(){
  const name = document.getElementById("loginName").value.trim();
  const codeStr = document.getElementById("loginCode").value.trim();
  const errorEl = document.getElementById("loginError");

  errorEl.classList.add("hidden");
  errorEl.textContent = "";

  if(!codeStr){
    errorEl.textContent = "Enter your code.";
    errorEl.classList.remove("hidden");
    return;
  }

  // –£—á–∏—Ç–µ–ª—å
  if(codeStr === "6678"){
    currentUser = null;
    setTopInfo(`Logged in as <strong>TEACHER</strong> ¬∑ code 6678`);
    renderTeacherTable();
    showOnly("teacherScreen");
    return;
  }

  const num = Number(codeStr);
  if(!Number.isInteger(num)){
    errorEl.textContent = "Code must be a number.";
    errorEl.classList.remove("hidden");
    return;
  }

  const classLabel = getClassByCode(num);
  if(!classLabel){
    errorEl.textContent = "Unknown student code. Ask your teacher.";
    errorEl.classList.remove("hidden");
    return;
  }
  if(!name){
    errorEl.textContent = "Enter your name.";
    errorEl.classList.remove("hidden");
    return;
  }

  currentUser = loadStudent(num, name, classLabel);
  saveCurrent();

  setTopInfo(
    `Class <strong>${currentUser.classLabel}</strong> ¬∑ Student: <strong>${currentUser.name}</strong> (code ${currentUser.code}) ¬∑ Stars: <strong id="topStars">${currentUser.stars}</strong>`
  );

  buildMainMenu();
  updateTopStars();
  showOnly("mainMenuScreen");
}

function backToLogin(){
  currentUser = null;
  setTopInfo("Not logged in");
  document.getElementById("loginName").value = "";
  document.getElementById("loginCode").value = "";
  showOnly("loginScreen");
}

/* ---------- MAIN MENU UI ---------- */

function buildMainMenu(){
  if(!currentUser) return;
  const menuInfo = document.getElementById("menuInfo");
  menuInfo.innerHTML =
    `Class <strong>${currentUser.classLabel}</strong>, student <strong>${currentUser.name}</strong> (code ${currentUser.code})`;

  document.getElementById("menuStars").textContent = currentUser.stars ?? 0;

  const grid = document.getElementById("menuTopics");
  grid.innerHTML = "";

  topics.forEach(t => {
    const div = document.createElement("div");
    div.className = "topic-card";
    const color = topicColors[t.id] || "#ff6f00";
    div.style.borderColor = color + "66";

    div.innerHTML = `
      <div class="topic-card-title">${t.id}. ${t.title}</div>
      <div class="muted">${t.level}</div>
    `;

    div.addEventListener("click", () => openTopic(t.id));
    grid.appendChild(div);
  });

  // AI –ø–∞–Ω–µ–ª—å ‚Äì –ø—Ä–æ—Å—Ç–æ–µ demo-—Å–æ–æ–±—â–µ–Ω–∏–µ
  const chat = document.getElementById("chatBox");
  chat.innerHTML = "";
  const msg = document.createElement("div");
  msg.className = "chat-msg";
  msg.textContent = "AI Bayan chat will be added later. Now use grammar topics and exercises.";
  chat.appendChild(msg);
  document.getElementById("aiLimit").textContent = "¬∑ demo mode";
}

/* ---------- TOPIC SCREEN + 1 –ø–æ–ø—ã—Ç–∫–∞ ---------- */

function openTopic(id){
  if(!currentUser) return;
  currentTopicId = id;

  const t = topics.find(x => x.id === id);
  if(!t) return;

  const color = topicColors[id] || "#ff6f00";
  document.documentElement.style.setProperty("--topicColor", color);

  document.getElementById("topicHeaderTitle").textContent = `${id}. ${t.title}`;

  // –ø—Ä–∞–≤–∏–ª–æ
  const rc = document.getElementById("topicRuleContainer");
  rc.innerHTML = "";
  const gbox = document.createElement("div");
  gbox.className = "grammar-box";
  gbox.innerHTML = `
    <strong>Rule (EN):</strong> ${t.explanation || ""}
    ${
      t.formulas && t.formulas.length
        ? "<div style='margin-top:6px;'>" +
          t.formulas.map(f => `<span class="formula">${f}</span>`).join(" ") +
          "</div>"
        : ""
    }
    ${
      t.ruleRu
        ? `<div style="margin-top:8px;font-size:13px;"><strong>–ü—Ä–∞–≤–∏–ª–æ (RU):</strong><br>${t.ruleRu}</div>`
        : ""
    }
  `;
  rc.appendChild(gbox);

  if(t.examples && t.examples.length){
    const ul = document.createElement("ul");
    ul.className = "examples";
    t.examples.forEach(e => {
      const li = document.createElement("li");
      li.textContent = e;
      ul.appendChild(li);
    });
    rc.appendChild(ul);
  }

  // —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—è
  const ec = document.getElementById("topicExercisesContainer");
  ec.innerHTML = "";

  if(!t.exercises || t.exercises.length === 0){
    const p = document.createElement("p");
    p.className = "muted";
    p.style.marginTop = "10px";
    p.textContent = "Exercises for this topic will be added later.";
    ec.appendChild(p);
  }else{
    const wrapper = document.createElement("div");
    wrapper.className = "exercises";

    t.exercises.forEach((ex, exIndex) => {
      const block = document.createElement("div");
      block.className = "exercise-block";
      block.style.border = "1px solid #ffe0b2";
      block.style.borderRadius = "12px";
      block.style.background = "#fffdf7";
      block.style.padding = "10px 12px";
      block.style.marginBottom = "10px";

      const title = document.createElement("div");
      title.className = "exercise-title";
      title.textContent = ex.title || `Exercise ${exIndex+1}`;
      block.appendChild(title);

      ex.questions.forEach((q, qIndex) => {
        const row = document.createElement("div");
        row.className = "question-row";
        row.style.fontSize = "13px";
        row.style.marginBottom = "6px";
        row.style.display = "flex";
        row.style.flexWrap = "wrap";
        row.style.gap = "6px";
        row.style.alignItems = "center";

        const qText = document.createElement("div");
        qText.className = "question-text";
        qText.style.flex = "1 1 160px";
        qText.textContent = `${qIndex+1}) ${q.text}`;
        row.appendChild(qText);

        const opts = document.createElement("div");
        opts.className = "options";
        opts.style.display = "flex";
        opts.style.flexWrap = "wrap";
        opts.style.gap = "6px";

        if(q.options && q.options.length){
          q.options.forEach((opt, optIndex) => {
            const label = document.createElement("label");
            label.style.background = "#ffffff";
            label.style.borderRadius = "999px";
            label.style.border = "1px solid #ffd180";
            label.style.padding = "2px 8px";
            label.style.cursor = "pointer";
            label.style.display = "inline-flex";
            label.style.alignItems = "center";
            label.style.gap = "3px";

            const radio = document.createElement("input");
            radio.type = "radio";
            const gname = `t${id}_e${exIndex}_q${qIndex}`;
            radio.name = gname;
            radio.value = optIndex;

            label.appendChild(radio);
            label.appendChild(document.createTextNode(" " + opt));
            opts.appendChild(label);
          });
        }

        row.appendChild(opts);

        const mark = document.createElement("span");
        mark.className = "mark";
        mark.id = `mark_t${id}_e${exIndex}_q${qIndex}`;
        mark.style.width = "18px";
        mark.style.textAlign = "center";
        mark.style.fontSize = "16px";
        mark.style.fontWeight = "700";
        row.appendChild(mark);

        block.appendChild(row);
      });

      const footer = document.createElement("div");
      footer.className = "exercise-footer";
      footer.style.marginTop = "6px";
      footer.style.display = "flex";
      footer.style.justifyContent = "space-between";
      footer.style.alignItems = "center";
      footer.style.gap = "8px";

      const small = document.createElement("small");
      small.style.fontSize = "11px";
      small.style.color = "#6b5f55";
      small.textContent = "Each correct answer gives you 1 star. Only ONE attempt for this topic.";
      footer.appendChild(small);

      const btn = document.createElement("button");
      btn.className = "btn btn-primary";
      btn.textContent = "Check";
      btn.addEventListener("click", () => checkExercise(id, exIndex));
      footer.appendChild(btn);

      block.appendChild(footer);
      wrapper.appendChild(block);
    });

    ec.appendChild(wrapper);
  }

  const status = document.getElementById("topicStatus");
  status.textContent = "";
  if(currentUser && currentUser.attempts && currentUser.attempts[id]){
    status.textContent = "You have already used your attempt for this topic.";
  }else{
    status.textContent = "You still have 1 attempt for this topic.";
  }

  showOnly("topicScreen");
}

function backToMenu(){
  if(!currentUser){
    backToLogin();
    return;
  }
  buildMainMenu();
  showOnly("mainMenuScreen");
}

/* ---------- CHECK EXERCISE (1 –ø–æ–ø—ã—Ç–∫–∞ –Ω–∞ —Ç–µ–º—É) ---------- */

function checkExercise(topicId, exIndex){
  if(!currentUser) return;

  const status = document.getElementById("topicStatus") || { textContent:"" };

  // –£–∂–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª –ø–æ–ø—ã—Ç–∫—É?
  if(currentUser.attempts && currentUser.attempts[topicId]){
    status.textContent = "You have already used your attempt for this topic.";
    return;
  }

  const t = topics.find(x => x.id === topicId);
  if(!t) return;

  const ex = t.exercises[exIndex];
  if(!ex) return;

  let gained = 0;

  ex.questions.forEach((q, qIndex) => {
    const gname = `t${topicId}_e${exIndex}_q${qIndex}`;
    const selected = document.querySelector(`input[name="${gname}"]:checked`);
    const markEl = document.getElementById(`mark_t${topicId}_e${exIndex}_q${qIndex}`);

    if(!markEl) return;
    markEl.textContent = "";
    markEl.style.color = "#3a2b1f";

    if(!selected){
      markEl.textContent = "‚Ä¢";
      return;
    }

    const chosen = Number(selected.value);
    if(chosen === q.correct){
      markEl.textContent = "‚úì";
      markEl.style.color = "#2e7d32";
      gained++;
    }else{
      markEl.textContent = "‚úó";
      markEl.style.color = "#c62828";
    }
  });

  // –ü–æ–º–µ—á–∞–µ–º, —á—Ç–æ –ø–æ–ø—ã—Ç–∫–∞ –¥–ª—è –í–°–ï–ô —Ç–µ–º—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∞
  if(!currentUser.attempts || typeof currentUser.attempts !== "object"){
    currentUser.attempts = {};
  }
  currentUser.attempts[topicId] = true;

  if(gained > 0){
    currentUser.stars += gained;
    saveCurrent();
    updateTopStars();
    status.textContent = `Well done! You gained ${gained} star(s). Your attempt for this topic is now used.`;
  }else{
    saveCurrent();
    status.textContent = "No correct answers this time. Your attempt for this topic is used.";
  }
}

/* ---------- TEACHER TABLE ---------- */

function renderTeacherTable(){
  const tbody = document.querySelector("#teacherTable tbody");
  tbody.innerHTML = "";

  const allStudents = [];

  classRanges.forEach(r => {
    for(let code = r.from; code <= r.to; code++){
      const key = studentKey(code);
      let data = null;
      try{
        data = JSON.parse(localStorage.getItem(key));
      }catch(e){
        data = null;
      }
      if(data){
        if(!data.attempts || typeof data.attempts !== "object"){
          data.attempts = {};
        }
        allStudents.push(data);
      }
    }
  });

  if(allStudents.length === 0){
    const tr = document.createElement("tr");
    const td = document.createElement("td");
    td.colSpan = 6;
    td.textContent = "No student data in this browser yet.";
    tr.appendChild(td);
    tbody.appendChild(tr);
    return;
  }

  allStudents.sort((a,b) => a.code - b.code);

  allStudents.forEach(s => {
    const tr = document.createElement("tr");

    const clsTd = document.createElement("td");
    clsTd.textContent = s.classLabel || getClassByCode(s.code) || "";
    const codeTd = document.createElement("td");
    codeTd.textContent = s.code;
    const nameTd = document.createElement("td");
    nameTd.textContent = s.name || "";
    const starsTd = document.createElement("td");
    starsTd.textContent = s.stars ?? 0;
    const loginTd = document.createElement("td");
    loginTd.textContent = s.lastLogin || "";

    const attemptsTd = document.createElement("td");
    const cnt = s.attempts ? Object.keys(s.attempts).length : 0;
    attemptsTd.textContent = `${cnt} topic(s)`;

    tr.appendChild(clsTd);
    tr.appendChild(codeTd);
    tr.appendChild(nameTd);
    tr.appendChild(starsTd);
    tr.appendChild(loginTd);
    tr.appendChild(attemptsTd);

    tbody.appendChild(tr);
  });
}

/* ---------- STARS DISPLAY ---------- */

function updateTopStars(){
  if(!currentUser) return;
  const topStarsEl = document.getElementById("topStars");
  if(topStarsEl) topStarsEl.textContent = currentUser.stars;

  const menuStarsEl = document.getElementById("menuStars");
  if(menuStarsEl) menuStarsEl.textContent = currentUser.stars;
}

/* ---------- INIT ---------- */

showOnly("loginScreen");
</script>
</body>
</html>
