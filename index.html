<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>ENGLISH WITH AI BAYAN ‚Äì Advanced</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <style>
    :root{
      --main:#ff6f00;          /* —è—Ä–∫–∏–π –æ—Ä–∞–Ω–∂–µ–≤—ã–π */
      --main-dark:#e65100;     /* —Ç—ë–º–Ω—ã–π –æ—Ä–∞–Ω–∂–µ–≤—ã–π */
      --soft:#ff8f00;          /* –º—è–≥–∫–∏–π –æ—Ä–∞–Ω–∂–µ–≤—ã–π */
      --gold:#ffd54f;
      --bg:#fff9f0;            /* —Å–≤–µ—Ç–ª—ã–π —Ñ–æ–Ω */
      --topicColor:#ff6f00;
    }

    *{
      box-sizing:border-box;
      margin:0;
      padding:0;
      font-family:system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",sans-serif;
    }

    body{
      background:var(--bg);
      color:#3a2b1f;
    }

    /* HEADER ------------------------------------------------------------ */
    header{
      background:linear-gradient(90deg,var(--main-dark),var(--main));
      color:#fff;
      padding:10px 24px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      box-shadow:0 2px 6px rgba(0,0,0,.25);
    }

    .brand{
      display:flex;
      align-items:center;
      gap:12px;
    }

    .logo-img{
      width:52px;
      height:52px;
      border-radius:50%;
      object-fit:cover;
      border:3px solid var(--gold);
      background:white;
    }

    .brand-text h1{
      font-size:18px;
      letter-spacing:.04em;
    }

    .brand-text span{
      font-size:12px;
      opacity:.9;
    }

    .top-info{
      font-size:13px;
      text-align:right;
    }
    .top-info strong{color:var(--gold);}

    /* MAIN -------------------------------------------------------------- */
    main{
      padding:16px;
      max-width:1300px;
      margin:0 auto;
    }

    .card{
      background:#fff;
      border-radius:14px;
      box-shadow:0 4px 14px rgba(0,0,0,.1);
      padding:20px;
    }

    .hidden{display:none !important;}

    .section-title{
      font-size:18px;
      margin-bottom:10px;
      font-weight:600;
    }
    .muted{
      color:#6b5f55;
      font-size:12px;
    }

    .field-label{
      font-size:14px;
      margin-bottom:4px;
    }

    .text-input{
      width:100%;
      padding:10px 12px;
      border-radius:10px;
      border:1px solid #d6cec7;
      margin-bottom:14px;
      font-size:14px;
      background:#fffdf8;
    }
    .text-input:focus{
      outline:none;
      border-color:var(--soft);
      box-shadow:0 0 0 2px rgba(255,143,0,.25);
    }

    /* BUTTONS ----------------------------------------------------------- */
    .btn{
      border:none;
      border-radius:10px;
      padding:10px 18px;
      font-size:14px;
      font-weight:600;
      cursor:pointer;
      display:inline-flex;
      align-items:center;
      justify-content:center;
      gap:6px;
    }

    .btn-primary{
      background:var(--main);
      color:#fff;
    }
    .btn-primary:hover{background:var(--main-dark);}

    .btn-ghost{
      background:#fff3e0;
      color:var(--main-dark);
    }
    .btn-ghost:hover{
      background:#ffe0b2;
    }

    .error{
      margin-top:10px;
      color:#b00020;
      font-size:13px;
    }

    /* LOGIN ------------------------------------------------------------- */
    #loginScreen{
      max-width:520px;
      margin:40px auto;
    }

    /* MAIN MENU --------------------------------------------------------- */
    #mainMenuScreen{
      display:grid;
      grid-template-columns:2fr 1.2fr;
      gap:16px;
    }
    @media(max-width:960px){
      #mainMenuScreen{
        grid-template-columns:1fr;
      }
    }

    .tag{
      display:inline-block;
      padding:3px 7px;
      border-radius:999px;
      background:#ffe0b2;
      font-size:11px;
      color:var(--main-dark);
    }

    .top-row{
      display:flex;
      justify-content:space-between;
      align-items:center;
      flex-wrap:wrap;
      gap:8px;
      margin-bottom:12px;
    }

    .stars-badge{
      display:inline-flex;
      align-items:center;
      gap:4px;
      padding:4px 8px;
      border-radius:999px;
      background:#fff8e1;
      border:1px solid #ffecb3;
      font-size:12px;
    }
    .star-icon{color:#ffa000;}

    .topics-grid{
      display:grid;
      grid-template-columns:1fr 1fr;
      gap:10px;
    }
    @media(max-width:700px){
      .topics-grid{grid-template-columns:1fr;}
    }

    .topic-card{
      border-radius:12px;
      border:1px solid #ffe0b2;
      padding:10px 12px;
      background:#fffdf7;
      cursor:pointer;
      transition:.15s;
      display:flex;
      flex-direction:column;
      gap:4px;
    }
    .topic-card:hover{
      background:#fff3e0;
      transform:translateY(-1px);
    }

    .topic-card-title{
      font-size:14px;
      font-weight:600;
    }

    /* AI PANEL ---------------------------------------------------------- */
    #aiPanel{
      background:#fff;
      border-radius:14px;
      padding:14px;
      box-shadow:0 2px 10px rgba(0,0,0,.07);
      display:flex;
      flex-direction:column;
      gap:8px;
      min-height:260px;
    }

    #aiPanel h3{
      font-size:15px;
      margin-bottom:4px;
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:6px;
    }
    #aiLimit{font-size:11px;}

    .chat-note{
      font-size:11px;
      color:#6b5f55;
    }

    .chat-box{
      flex:1;
      border-radius:10px;
      border:1px solid #ffe0b2;
      padding:8px;
      background:#fffdf7;
      font-size:13px;
      overflow-y:auto;
    }

    #aiQuestion{
      width:100%;
      min-height:60px;
      resize:vertical;
      border-radius:10px;
      border:1px solid #ffe0b2;
      padding:8px;
      background:#fffdf7;
    }

    .chat-actions{
      display:flex;
      justify-content:flex-end;
      margin-top:4px;
    }

    /* TOPIC SCREEN ------------------------------------------------------ */
    #topicScreen{
      max-width:1000px;
      margin:0 auto;
    }

    .topic-header{
      border-radius:16px 16px 0 0;
      padding:14px 16px;
      background:linear-gradient(90deg,var(--topicColor),var(--main-dark));
      color:#fff;
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:10px;
      flex-wrap:wrap;
    }

    .topic-header-title{
      font-size:18px;
      font-weight:600;
    }

    .topic-header-buttons{
      display:flex;
      gap:6px;
      flex-wrap:wrap;
    }

    .btn-topic{
      border:none;
      border-radius:999px;
      padding:6px 12px;
      font-size:12px;
      font-weight:600;
      cursor:pointer;
    }

    .btn-topic.back{
      background:#fff;
      color:var(--topicColor);
    }

    .btn-topic.menu{
      background:rgba(255,255,255,.3);
      color:#fff;
      border:1px solid rgba(255,255,255,.4);
    }

    .topic-body{
      background:#fff;
      border-radius:0 0 16px 16px;
      box-shadow:0 4px 14px rgba(0,0,0,.1);
      padding:16px;
    }

    .grammar-box{
      background:#fff7e6;
      border-left:4px solid var(--topicColor);
      padding:10px 12px;
      border-radius:10px;
      font-size:14px;
    }

    .formula{
      font-family:monospace;
      background:#ffe0b2;
      padding:3px 6px;
      border-radius:6px;
      display:inline-block;
      margin-top:4px;
      margin-right:4px;
    }

    .examples{
      margin-top:8px;
      font-size:13px;
    }
    .examples li{
      margin-left:18px;
      margin-bottom:2px;
    }

    /* TEACHER SCREEN ---------------------------------------------------- */
    .top-buttons{
      display:flex;
      gap:8px;
      flex-wrap:wrap;
      margin-bottom:8px;
      align-items:center;
    }

    .table-wrapper{
      overflow-x:auto;
      margin-top:10px;
    }

    table{
      width:100%;
      border-collapse:collapse;
      font-size:13px;
    }

    th,td{
      border:1px solid #eddcc8;
      padding:6px 8px;
      text-align:left;
      white-space:nowrap;
    }

    th{
      background:#fff3e0;
      font-weight:600;
    }

    /* PRINT MODE -------------------------------------------------------- */
    @media print{
      header, #loginScreen, #mainMenuScreen, #teacherScreen{
        display:none !important;
      }
      body{ background:#fff; }
      #topicScreen{ display:block !important; margin:0; padding:0; }
      .topic-body{ box-shadow:none; border-radius:0; }
    }
  </style>
</head>

<body>
<header>
  <div class="brand">
    <img src="logo.png" class="logo-img" alt="AI Bayan">
    <div class="brand-text">
      <h1>ENGLISH WITH AI BAYAN</h1>
      <span>Advanced ¬∑ 30 grammar topics</span>
    </div>
  </div>
  <div class="top-info" id="topInfo">Not logged in</div>
</header>

<main>

  <!-- LOGIN -->
  <section id="loginScreen" class="card">
    <h2 class="section-title">Login</h2>
    <p class="muted">Enter your <strong>Name</strong> and <strong>Code</strong>. Ask your teacher for the code.</p>

    <label class="field-label" for="loginName">Name</label>
    <input id="loginName" class="text-input" type="text" placeholder="Your name">

    <label class="field-label" for="loginCode">Code</label>
    <input id="loginCode" class="text-input" type="password" placeholder="Student or teacher code">

    <div style="display:flex;gap:8px;margin-top:4px">
      <button class="btn btn-primary" onclick="handleLogin()">Login</button>
      <button class="btn btn-ghost" onclick="backToLogin()">Reset</button>
    </div>

    <div id="loginError" class="error hidden"></div>
  </section>

  <!-- MAIN MENU (STUDENT) -->
  <section id="mainMenuScreen" class="hidden">
    <section class="card">
      <div class="top-row">
        <div>
          <h2 class="section-title">Advanced grammar topics</h2>
          <div id="menuInfo" class="muted"></div>
        </div>
        <div>
          <span class="stars-badge">
            <span class="star-icon">‚≠ê</span>
            Stars: <span id="menuStars">0</span>
          </span>
        </div>
      </div>

      <div class="topics-grid" id="menuTopics"></div>
    </section>

    <!-- AI PANEL -->
    <aside id="aiPanel">
      <div>
        <h3>
          AI Bayan
          <span id="aiLimit"></span>
        </h3>
        <p class="chat-note">
          Demo mode. AI chat will be added later.
        </p>
      </div>
      <div id="chatBox" class="chat-box"></div>
      <div>
        <textarea id="aiQuestion" disabled placeholder="AI chat is disabled"></textarea>
        <div class="chat-actions">
          <button class="btn btn-primary" id="askBtn" disabled>Ask</button>
        </div>
        <p class="chat-note">
          In the future your teacher will see your questions and answers here.
        </p>
      </div>
    </aside>
  </section>

  <!-- TOPIC SCREEN -->
  <section id="topicScreen" class="hidden">
    <div class="topic-header">
      <div class="topic-header-title" id="topicHeaderTitle">Topic</div>
      <div class="topic-header-buttons">
        <button class="btn-topic back" onclick="backToMenu()">‚Üê Back</button>
        <button class="btn-topic menu" onclick="backToMenu()">üè† Menu</button>
        <button class="btn-topic menu" onclick="window.print()">üñ® Print</button>
      </div>
    </div>

    <div class="topic-body">
      <div id="topicRuleContainer"></div>
      <div id="topicExercisesContainer"></div>
      <div id="topicStatus" class="muted" style="margin-top:8px;"></div>
    </div>
  </section>

  <!-- TEACHER SCREEN -->
  <section id="teacherScreen" class="hidden card">
    <div class="top-buttons">
      <button class="btn btn-ghost" onclick="backToLogin()">‚Üê Back to login</button>
      <span class="tag">Teacher mode</span>
    </div>

    <h2 class="section-title">Teacher dashboard</h2>
    <p class="muted">
      Shows data saved in this browser: stars and last login (per code).
    </p>

    <div class="table-wrapper">
      <table id="teacherTable">
        <thead>
          <tr>
            <th>Class</th>
            <th>Code</th>
            <th>Name</th>
            <th>Stars</th>
            <th>Last login</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>
  </section>

</main>

<script>
/* ---------- CLASS RANGES (PIN) ---------- */

const classRanges = [
  { cls: "3E",  from: 101,  to: 115 },
  { cls: "4G",  from: 201,  to: 215 },
  { cls: "5G",  from: 301,  to: 315 },
  { cls: "5Zh", from: 401,  to: 415 },
  { cls: "6G",  from: 501,  to: 515 },
  { cls: "7B",  from: 601,  to: 615 },
  { cls: "7V",  from: 701,  to: 715 },
  { cls: "8E",  from: 801,  to: 815 },
  { cls: "9Zh", from: 901,  to: 915 },
  { cls: "10A", from: 1001, to: 1015 }
];

function getClassByCode(num){
  for(const r of classRanges){
    if(num >= r.from && num <= r.to) return r.cls;
  }
  return null;
}

/* ---------- TOPIC COLORS (30) ---------- */

const topicColors = {
  1:"#f4511e",
  2:"#fb8c00",
  3:"#ef6c00",
  4:"#ff7043",
  5:"#ff8f00",
  6:"#ffb300",
  7:"#f57c00",
  8:"#e64a19",
  9:"#ff9100",
  10:"#ff6f00",
  11:"#f9a825",
  12:"#ffb74d",
  13:"#ffa726",
  14:"#ff9800",
  15:"#ffcc80",
  16:"#ffb300",
  17:"#fb8c00",
  18:"#f57c00",
  19:"#ef6c00",
  20:"#e65100",
  21:"#ff7043",
  22:"#ff6f00",
  23:"#ff8f00",
  24:"#ffa000",
  25:"#ffb300",
  26:"#ffca28",
  27:"#ffb74d",
  28:"#ffa726",
  29:"#ff9800",
  30:"#ff6f00"
};

/* ---------- TOPICS (30 ADVANCED) ---------- */

const topics = [
  {
    id:1,
    title:"Inversion after negative adverbials",
    level:"Advanced",
    explanation:"We use inversion (auxiliary + subject) after negative or limiting adverbials like never, seldom, rarely, only then, not until to sound more formal or emphatic.",
    ruleRu:"–ü–æ—Å–ª–µ –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã—Ö –∏–ª–∏ –æ–≥—Ä–∞–Ω–∏—á–∏—Ç–µ–ª—å–Ω—ã—Ö –Ω–∞—Ä–µ—á–∏–π (never, seldom, rarely, only then, not until –∏ –¥—Ä.) –∏—Å–ø–æ–ª—å–∑—É–µ–º –∏–Ω–≤–µ—Ä—Å–∏—é: –≤—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–π –≥–ª–∞–≥–æ–ª + –ø–æ–¥–ª–µ–∂–∞—â–µ–µ, —á—Ç–æ–±—ã —É—Å–∏–ª–∏—Ç—å –≤—ã—Å–∫–∞–∑—ã–≤–∞–Ω–∏–µ.",
    formulas:[
      "Never / Rarely / Seldom + AUX + S + V",
      "Not until + clause + AUX + S + V",
      "Only then / only later + AUX + S + V"
    ],
    examples:[
      "Never have I seen such chaos.",
      "Not until he left did she realise her mistake."
    ],
    exercises:[]
  },
  {
    id:2,
    title:"Cleft sentences for emphasis",
    level:"Advanced",
    explanation:"Cleft sentences with It is/was and What‚Ä¶ is/was help us emphasise a person, thing, time, place or reason.",
    ruleRu:"Cleft-–ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è –ø–æ–º–æ–≥–∞—é—Ç –ø–æ–¥—á–µ—Ä–∫–Ω—É—Ç—å –≤–∞–∂–Ω—É—é —á–∞—Å—Ç—å: It was John who‚Ä¶, What I need is‚Ä¶. –ò—Å–ø–æ–ª—å–∑—É–µ–º It is/was + X + who/that‚Ä¶ –∏–ª–∏ What + clause + is/was + X.",
    formulas:[
      "It is/was + X + who/that + clause",
      "What + clause + is/was + X"
    ],
    examples:[
      "It was my brother who broke the window.",
      "What I need is a short break."
    ],
    exercises:[]
  },
  {
    id:3,
    title:"Mixed conditionals (advanced use)",
    level:"Advanced",
    explanation:"Mixed conditionals connect unreal past actions with present results or unreal present states with unreal past results.",
    ruleRu:"–°–º–µ—à–∞–Ω–Ω—ã–µ —É—Å–ª–æ–≤–Ω—ã–µ —Å–≤—è–∑—ã–≤–∞—é—Ç –Ω–µ—Ä–µ–∞–ª—å–Ω–æ–µ –ø—Ä–æ—à–ª–æ–µ —Å –Ω–∞—Å—Ç–æ—è—â–∏–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–º –∏–ª–∏ –Ω–µ—Ä–µ–∞–ª—å–Ω–æ–µ –Ω–∞—Å—Ç–æ—è—â–µ–µ —Å –Ω–µ—Ä–µ–∞–ª—å–Ω—ã–º –ø—Ä–æ—à–ª—ã–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–º.",
    formulas:[
      "If + Past Perfect, would + V (now)",
      "If + Past Simple, would have + V3"
    ],
    examples:[
      "If I had studied harder, I would be at university now.",
      "If she were more careful, she would not have lost the documents."
    ],
    exercises:[]
  },
  {
    id:4,
    title:"Modal verbs of deduction (present & past)",
    level:"Advanced",
    explanation:"We use must, might, may, could and can‚Äôt to show how sure we are about something (deduction) in the present and the past.",
    ruleRu:"Must / can‚Äôt / might / may / could ‚Äì –º–æ–¥–∞–ª—å–Ω—ã–µ –≥–ª–∞–≥–æ–ª—ã –¥–ª—è –ø—Ä–µ–¥–ø–æ–ª–æ–∂–µ–Ω–∏–π: must ‚Äì –ø–æ—á—Ç–∏ —É–≤–µ—Ä–µ–Ω—ã, can‚Äôt ‚Äì —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ –Ω–µ–≤–æ–∑–º–æ–∂–Ω–æ; might/may/could ‚Äì –≤–æ–∑–º–æ–∂–Ω–æ. –î–ª—è –ø—Ä–æ—à–ª–æ–≥–æ –¥–æ–±–∞–≤–ª—è–µ–º have + V3.",
    formulas:[
      "must + V / must have + V3",
      "can‚Äôt + V / can‚Äôt have + V3",
      "might/may/could + V / might/may/could have + V3"
    ],
    examples:[
      "He must be at home ‚Äì the lights are on.",
      "She can‚Äôt have finished already ‚Äì it was too difficult."
    ],
    exercises:[]
  },
  {
    id:5,
    title:"Wishes and regrets (I wish / If only / would rather)",
    level:"Advanced",
    explanation:"We use I wish / If only to talk about regrets and unreal wishes about the present, past or future. We use would rather to express preference.",
    ruleRu:"I wish / If only + Past Simple ‚Äì —Å–æ–∂–∞–ª–µ–Ω–∏–µ –æ –Ω–∞—Å—Ç–æ—è—â–µ–º; + Past Perfect ‚Äì –æ –ø—Ä–æ—à–ª–æ–º; I wish + would ‚Äì –∂–µ–ª–∞–Ω–∏–µ, —á—Ç–æ–±—ã –∫—Ç–æ-—Ç–æ –∏–∑–º–µ–Ω–∏–ª –ø–æ–≤–µ–¥–µ–Ω–∏–µ; would rather ‚Äì –ø—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏–µ.",
    formulas:[
      "I wish / If only + Past Simple",
      "I wish / If only + Past Perfect",
      "I wish + would + V",
      "would rather + V / would rather + S + Past Simple"
    ],
    examples:[
      "I wish I spoke English better.",
      "If only I had studied harder."
    ],
    exercises:[]
  },
  {
    id:6,
    title:"Passive reporting structures",
    level:"Advanced",
    explanation:"We use passive reporting structures to sound more formal and impersonal, especially in news and academic style.",
    ruleRu:"–ü–∞—Å—Å–∏–≤–Ω—ã–µ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ —Å –≥–ª–∞–≥–æ–ª–∞–º–∏ —Å–æ–æ–±—â–µ–Ω–∏—è (say, think, believe, report –∏ –¥—Ä.) –¥–µ–ª–∞—é—Ç —Ä–µ—á—å –±–æ–ª–µ–µ —Ñ–æ—Ä–º–∞–ª—å–Ω–æ–π –∏ –±–µ–∑–ª–∏—á–Ω–æ–π: It is said that..., He is believed to....",
    formulas:[
      "It is/was said that + clause",
      "S is/was thought/believed/known to + V"
    ],
    examples:[
      "It is said that the company will close next year.",
      "He is believed to have left the country."
    ],
    exercises:[]
  },
  {
    id:7,
    title:"Participle clauses",
    level:"Advanced",
    explanation:"Participle clauses (V-ing, V3, having V3) allow us to join ideas and make sentences more compact and formal.",
    ruleRu:"–ü—Ä–∏—á–∞—Å—Ç–Ω—ã–µ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ —Å V-ing, V3 –∏ having V3 –∑–∞–º–µ–Ω—è—é—Ç –ø—Ä–∏–¥–∞—Ç–æ—á–Ω—ã–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è –∏ –¥–µ–ª–∞—é—Ç —Ç–µ–∫—Å—Ç –±–æ–ª–µ–µ –∫–æ–º–ø–∞–∫—Ç–Ω—ã–º.",
    formulas:[
      "V-ing ..., S + V",
      "V3 ..., S + V",
      "Having V3 ..., S + V"
    ],
    examples:[
      "Walking along the street, I met an old friend.",
      "Having finished his work, he went home."
    ],
    exercises:[]
  },
  {
    id:8,
    title:"Advanced linking words (contrast & concession)",
    level:"Advanced",
    explanation:"Advanced linking words show contrast and concession: although, even though, whereas, while, in spite of, despite, however, nevertheless.",
    ruleRu:"–î–ª—è –ø—Ä–æ—Ç–∏–≤–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∏—è –∏—Å–ø–æ–ª—å–∑—É–µ–º although / even though, whereas / while, in spite of / despite, however / nevertheless.",
    formulas:[
      "Although / Even though + clause",
      "Whereas / While + clause",
      "In spite of / Despite + noun / V-ing"
    ],
    examples:[
      "Although it was raining, we went out.",
      "Despite the rain, we went out."
    ],
    exercises:[]
  },
  {
    id:9,
    title:"Reporting verbs and patterns",
    level:"Advanced",
    explanation:"Different reporting verbs take different structures: say, tell, explain, suggest, deny, admit, accuse sb of, insist on, recommend etc.",
    ruleRu:"Say, tell, suggest, deny, admit, accuse sb of, insist on, recommend –∏ –¥—Ä. –∏–º–µ—é—Ç —Å–≤–æ–∏ —Å—Ö–µ–º—ã: say (that), tell sb (that), suggest + V-ing / that –∏ —Ç.–¥.",
    formulas:[
      "say (that) + clause",
      "tell + object + (that) + clause",
      "suggest / recommend + V-ing / that + clause"
    ],
    examples:[
      "He suggested going to the cinema.",
      "She denied taking the money."
    ],
    exercises:[]
  },
  {
    id:10,
    title:"Relative clauses with prepositions",
    level:"Advanced",
    explanation:"In formal English prepositions can come before relative pronouns (to whom, with whom, about which). In spoken English, prepositions are usually at the end.",
    ruleRu:"–í —Ñ–æ—Ä–º–∞–ª—å–Ω–æ–º —Å—Ç–∏–ª–µ –ø—Ä–µ–¥–ª–æ–≥ —Å—Ç–∞–≤–∏—Ç—Å—è –ø–µ—Ä–µ–¥ –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω—ã–º –º–µ—Å—Ç–æ–∏–º–µ–Ω–∏–µ–º (to whom, with whom, about which). –í —Ä–∞–∑–≥–æ–≤–æ—Ä–Ω–æ–º ‚Äì —á–∞—â–µ –≤ –∫–æ–Ω—Ü–µ: the person who I spoke to.",
    formulas:[
      "the person to whom I spoke",
      "the person who I spoke to"
    ],
    examples:[
      "The professor to whom I spoke was very helpful.",
      "The girl who I was talking to is my cousin."
    ],
    exercises:[]
  },
  {
    id:11,
    title:"Reduced relative clauses",
    level:"Advanced",
    explanation:"We can shorten relative clauses when the subject is the same: the man who is standing ‚Üí the man standing near the door.",
    ruleRu:"–°–æ–∫—Ä–∞—â—ë–Ω–Ω—ã–µ –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω—ã–µ –ø—Ä–∏–¥–∞—Ç–æ—á–Ω—ã–µ: —É–±–∏—Ä–∞–µ–º who/which –∏ –≥–ª–∞–≥–æ–ª be, –∫–æ–≥–¥–∞ –ø–æ–¥–ª–µ–∂–∞—â–µ–µ —Ç–æ –∂–µ —Å–∞–º–æ–µ.",
    formulas:[
      "S who is V-ing ‚Üí S V-ing",
      "S which is V3 ‚Üí S V3"
    ],
    examples:[
      "Students who are taking the exam must be quiet ‚Üí Students taking the exam must be quiet.",
      "The books which are printed in colour are more expensive ‚Üí The books printed in colour are more expensive."
    ],
    exercises:[]
  },
  {
    id:12,
    title:"Nominalisation (verbs ‚Üí nouns)",
    level:"Advanced",
    explanation:"Nominalisation means using nouns instead of verbs to sound more formal and academic.",
    ruleRu:"Nominalisation ‚Äì –ø—Ä–µ–≤—Ä–∞—â–∞–µ–º –≥–ª–∞–≥–æ–ª—ã –∏ –ø—Ä–∏–ª–∞–≥–∞—Ç–µ–ª—å–Ω—ã–µ –≤ —Å—É—â–µ—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã–µ: decide ‚Üí decision, fail ‚Üí failure, different ‚Üí difference.",
    formulas:[
      "V ‚Üí N (develop ‚Üí development)",
      "Adj ‚Üí N (important ‚Üí importance)"
    ],
    examples:[
      "We decided to change the plan ‚Üí We made a decision to change the plan.",
      "The system failed ‚Üí There was a failure in the system."
    ],
    exercises:[]
  },
  {
    id:13,
    title:"Future in the past",
    level:"Advanced",
    explanation:"Future in the past describes something that was in the future at a past time: was going to, would.",
    ruleRu:"Future in the past ‚Äì –±—É–¥—É—â–µ–µ –∏–∑ —Ç–æ—á–∫–∏ –∑—Ä–µ–Ω–∏—è –ø—Ä–æ—à–ª–æ–≥–æ: was/were going to, would + V.",
    formulas:[
      "was/were going to + V",
      "would + V (future seen from the past)"
    ],
    examples:[
      "I was going to call you, but I forgot.",
      "He said he would help us."
    ],
    exercises:[]
  },
  {
    id:14,
    title:"Emphasis with do / did",
    level:"Advanced",
    explanation:"We use do/does/did to give emphasis in affirmative sentences.",
    ruleRu:"Do / does / did –≤ —É—Ç–≤–µ—Ä–¥–∏—Ç–µ–ª—å–Ω—ã—Ö –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è—Ö –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è —É—Å–∏–ª–µ–Ω–∏—è: I do agree with you.",
    formulas:[
      "do/does + V",
      "did + V (Past Simple)"
    ],
    examples:[
      "I do understand your point.",
      "She did try her best."
    ],
    exercises:[]
  },
  {
    id:15,
    title:"Subjunctive in formal English",
    level:"Advanced",
    explanation:"The present subjunctive is used after verbs like suggest, recommend, insist, demand in formal style.",
    ruleRu:"Subjunctive (–∫–æ–Ω—ä—é–Ω–∫—Ç–∏–≤) –≤ —Å–æ–≤—Ä–µ–º–µ–Ω–Ω–æ–º –∞–Ω–≥–ª–∏–π—Å–∫–æ–º: insist, demand, suggest, recommend + that + S + base form.",
    formulas:[
      "They suggested that he go.",
      "The teacher insisted that she stay."
    ],
    examples:[
      "I suggest that he see a doctor.",
      "The manager insisted that the report be ready by Monday."
    ],
    exercises:[]
  },
  {
    id:16,
    title:"Hedging and tentative language",
    level:"Advanced",
    explanation:"Hedging makes statements less direct: seem, appear, tend to, kind of, a bit, perhaps, probably.",
    ruleRu:"Hedging –¥–µ–ª–∞–µ—Ç –≤—ã—Å–∫–∞–∑—ã–≤–∞–Ω–∏—è –º—è–≥—á–µ: It seems that..., It appears that..., He tends to..., It is kind of difficult.",
    formulas:[
      "It seems/appears that + clause",
      "S tends to + V"
    ],
    examples:[
      "It seems that we need more time.",
      "He tends to forget names."
    ],
    exercises:[]
  },
  {
    id:17,
    title:"Complex noun phrases",
    level:"Advanced",
    explanation:"Complex noun phrases combine nouns, adjectives and prepositional phrases: a long-term educational development plan.",
    ruleRu:"–°–ª–æ–∂–Ω—ã–µ –∏–º–µ–Ω–Ω—ã–µ –≥—Ä—É–ø–ø—ã –æ–±—ä–µ–¥–∏–Ω—è—é—Ç –ø—Ä–∏–ª–∞–≥–∞—Ç–µ–ª—å–Ω—ã–µ, —Å—É—â–µ—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã–µ –∏ –ø—Ä–µ–¥–ª–æ–≥–∏: a highly efficient public transport system.",
    formulas:[
      "Adj + N + of + N",
      "Adv + Adj + N"
    ],
    examples:[
      "A highly effective learning strategy.",
      "A long-term environmental protection programme."
    ],
    exercises:[]
  },
  {
    id:18,
    title:"Advanced gerund & infinitive patterns",
    level:"Advanced",
    explanation:"Some verbs change meaning with gerund vs infinitive: remember doing / remember to do, stop doing / stop to do.",
    ruleRu:"–ì–µ—Ä—É–Ω–¥–∏–π –∏ –∏–Ω—Ñ–∏–Ω–∏—Ç–∏–≤ –ø–æ—Å–ª–µ –Ω–µ–∫–æ—Ç–æ—Ä—ã—Ö –≥–ª–∞–≥–æ–ª–æ–≤ –º–µ–Ω—è—é—Ç –∑–Ω–∞—á–µ–Ω–∏–µ: remember doing (–ø—Ä–æ—à–ª—ã–π –æ–ø—ã—Ç), remember to do (–Ω–µ –∑–∞–±—ã—Ç—å —Å–¥–µ–ª–∞—Ç—å).",
    formulas:[
      "remember doing / remember to do",
      "stop doing / stop to do"
    ],
    examples:[
      "I remember meeting her at the conference.",
      "Remember to lock the door."
    ],
    exercises:[]
  },
  {
    id:19,
    title:"Fronting and thematisation",
    level:"Advanced",
    explanation:"We can move information to the front for emphasis: This book I really enjoyed.",
    ruleRu:"Fronting ‚Äì –≤—ã–Ω–æ—Å–∏–º —ç–ª–µ–º–µ–Ω—Ç –≤ –Ω–∞—á–∞–ª–æ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è –¥–ª—è –∞–∫—Ü–µ–Ω—Ç–∞: What I need most is rest.",
    formulas:[
      "Object / phrase to front + clause",
      "What-clause for focus"
    ],
    examples:[
      "This problem we cannot ignore.",
      "What I like most is the atmosphere."
    ],
    exercises:[]
  },
  {
    id:20,
    title:"Ellipsis and substitution",
    level:"Advanced",
    explanation:"We can avoid repetition using ellipsis (leaving words out) and substitution (do so, one, ones).",
    ruleRu:"Ellipsis ‚Äì –æ–ø—É—Å–∫–∞–Ω–∏–µ –ø–æ–≤—Ç–æ—Ä—è—é—â–∏—Ö—Å—è —Å–ª–æ–≤; substitution ‚Äì –∑–∞–º–µ–Ω–∞ –Ω–∞ do (so), one, ones –∏ –¥—Ä.",
    formulas:[
      "do so / do it",
      "one / ones"
    ],
    examples:[
      "I haven‚Äôt finished my project yet, but she has.",
      "I prefer the red one."
    ],
    exercises:[]
  },
  {
    id:21,
    title:"Inversion in conditionals (Had I known...)",
    level:"Advanced",
    explanation:"In formal style we can invert if-clauses: Had I known, I would have told you.",
    ruleRu:"–í —Ñ–æ—Ä–º–∞–ª—å–Ω–æ–º —Å—Ç–∏–ª–µ —É—Å–ª–æ–≤–Ω—ã–µ –º–æ–∂–Ω–æ –ø–∏—Å–∞—Ç—å —Å –∏–Ω–≤–µ—Ä—Å–∏–µ–π –±–µ–∑ if: Had I known..., Were I you..., Should you need help....",
    formulas:[
      "Had + S + V3, ...",
      "Were + S + to V, ..."
    ],
    examples:[
      "Had I known about the problem, I would have helped.",
      "Were I you, I would apologise."
    ],
    exercises:[]
  },
  {
    id:22,
    title:"Advanced passive (get-passive, passive modals)",
    level:"Advanced",
    explanation:"We use get-passive in informal English for change or something unexpected, and passive with modals to focus on the action.",
    ruleRu:"Get-passive: He got promoted. Passive —Å –º–æ–¥–∞–ª—å–Ω—ã–º–∏: The work must be finished today.",
    formulas:[
      "S + get + V3",
      "modal + be + V3"
    ],
    examples:[
      "He got fired last week.",
      "The report must be submitted by Friday."
    ],
    exercises:[]
  },
  {
    id:23,
    title:"Idiomatic phrasal verbs",
    level:"Advanced",
    explanation:"Many phrasal verbs have idiomatic meanings not clear from the words: bring up, come up with, look forward to.",
    ruleRu:"–§—Ä–∞–∑–æ–≤—ã–µ –≥–ª–∞–≥–æ–ª—ã —Å –ø–µ—Ä–µ–Ω–æ—Å–Ω—ã–º –∑–Ω–∞—á–µ–Ω–∏–µ–º: bring up (–≤–æ—Å–ø–∏—Ç—ã–≤–∞—Ç—å), come up with (–ø—Ä–∏–¥—É–º–∞—Ç—å), look forward to (—Å –Ω–µ—Ç–µ—Ä–ø–µ–Ω–∏–µ–º –∂–¥–∞—Ç—å).",
    formulas:[
      "verb + particle ‚Üí new meaning"
    ],
    examples:[
      "They came up with a brilliant idea.",
      "I‚Äôm looking forward to seeing you."
    ],
    exercises:[]
  },
  {
    id:24,
    title:"Collocations with make / do / take / have",
    level:"Advanced",
    explanation:"Some verbs naturally go together with certain nouns: make a decision, do homework, take a risk, have a rest.",
    ruleRu:"–£—Å—Ç–æ–π—á–∏–≤—ã–µ —Å–æ—á–µ—Ç–∞–Ω–∏—è: make a mistake, do research, take responsibility, have a shower –∏ —Ç.–¥.",
    formulas:[
      "make + decision / mistake / effort",
      "do + homework / research / work"
    ],
    examples:[
      "She made an important decision.",
      "He did a lot of research."
    ],
    exercises:[]
  },
  {
    id:25,
    title:"Approximation and vague language",
    level:"Advanced",
    explanation:"Approximation makes speech softer: sort of, kind of, more or less, around, roughly, something like that.",
    ruleRu:"–†–∞–∑–º—ã—Ç—ã–µ –≤—ã—Ä–∞–∂–µ–Ω–∏—è: kind of, sort of, more or less, around ten people, roughly 50%, and stuff like that.",
    formulas:[
      "around / roughly + number",
      "kind of / sort of + Adj / N"
    ],
    examples:[
      "There were around twenty students.",
      "It‚Äôs kind of difficult to explain."
    ],
    exercises:[]
  },
  {
    id:26,
    title:"Adverbial inversion (So do I / Neither do I)",
    level:"Advanced",
    explanation:"We use so/neither with inversion to show agreement: So do I, Neither did we.",
    ruleRu:"So / neither + auxiliary + subject: I like it. ‚Äì So do I. I don‚Äôt like it. ‚Äì Neither do I.",
    formulas:[
      "So + AUX + S",
      "Neither / Nor + AUX + S"
    ],
    examples:[
      "I love jazz. ‚Äì So do I.",
      "I didn‚Äôt enjoy the film. ‚Äì Neither did they."
    ],
    exercises:[]
  },
  {
    id:27,
    title:"Emphatic what- and all- clauses",
    level:"Advanced",
    explanation:"We can focus on a whole idea using what- and all- clauses: What I need is‚Ä¶, All I want is‚Ä¶.",
    ruleRu:"What / all-–∫–ª–∞—É–∑—ã –ø–æ–¥—á—ë—Ä–∫–∏–≤–∞—é—Ç –∏–¥–µ—é: What I need is time. All I want is to rest.",
    formulas:[
      "What + clause + is + N / to V",
      "All + clause + is + N / to V"
    ],
    examples:[
      "What matters most is your health.",
      "All I want is to relax."
    ],
    exercises:[]
  },
  {
    id:28,
    title:"Concessive clauses (even if, whether or not)",
    level:"Advanced",
    explanation:"Concessive clauses show that something happens despite a condition: even if, whether or not, no matter what/where/when.",
    ruleRu:"–£—Å—Ç—É–ø–∏—Ç–µ–ª—å–Ω—ã–µ –ø—Ä–∏–¥–∞—Ç–æ—á–Ω—ã–µ: even if, whether or not, no matter what/where/when ‚Äì –¥–µ–π—Å—Ç–≤–∏–µ –ø—Ä–æ–∏–∑–æ–π–¥—ë—Ç –Ω–µ—Å–º–æ—Ç—Ä—è –Ω–∏ –Ω–∞ —á—Ç–æ.",
    formulas:[
      "Even if + clause, ...",
      "No matter + wh-word + clause"
    ],
    examples:[
      "Even if it rains, we will go.",
      "No matter what you say, I‚Äôll try."
    ],
    exercises:[]
  },
  {
    id:29,
    title:"Linking devices in essays",
    level:"Advanced",
    explanation:"We use formal linking devices to organise essays: firstly, moreover, on the other hand, in conclusion.",
    ruleRu:"–§–æ—Ä–º–∞–ª—å–Ω—ã–µ —Å–≤—è–∑–∫–∏ –¥–ª—è —ç—Å—Å–µ: firstly, secondly, moreover, however, on the one hand / on the other hand, in conclusion.",
    formulas:[
      "Firstly / Secondly, ...",
      "On the one hand, ... On the other hand, ..."
    ],
    examples:[
      "Firstly, the government should invest more in education.",
      "On the one hand, cars are convenient; on the other hand, they cause pollution."
    ],
    exercises:[]
  },
  {
    id:30,
    title:"Formal vs informal style",
    level:"Advanced",
    explanation:"Advanced learners should choose formal or informal style depending on context: contractions, phrasal verbs, vocabulary and structures.",
    ruleRu:"–§–æ—Ä–º–∞–ª—å–Ω—ã–π —Å—Ç–∏–ª—å (no contractions, –±–æ–ª–µ–µ —Å–ª–æ–∂–Ω—ã–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã) –∏ –Ω–µ—Ñ–æ—Ä–º–∞–ª—å–Ω—ã–π (—Å–æ–∫—Ä–∞—â–µ–Ω–∏—è, —Ñ—Ä–∞–∑–æ–≤—ã–µ –≥–ª–∞–≥–æ–ª—ã) –∑–∞–≤–∏—Å—è—Ç –æ—Ç —Å–∏—Ç—É–∞—Ü–∏–∏.",
    formulas:[
      "Formal: children ‚Üí offspring, buy ‚Üí purchase",
      "Informal: kids, pick up, get"
    ],
    examples:[
      "The results indicate a significant increase in sales. (formal)",
      "The results show a big jump in sales. (informal)"
    ],
    exercises:[]
  }
];

/* ---------- STATE & STORAGE ---------- */

let currentUser = null; // {name, code, classLabel, stars, lastLogin}
let currentTopicId = null;

function todayStr(){
  return new Date().toISOString().slice(0,10);
}

function studentKey(code){
  // –æ—Ç–¥–µ–ª—å–Ω—ã–π namespace –¥–ª—è Advanced
  return "bayan_adv_student_" + code;
}

function loadStudent(code, name, classLabel){
  const key = studentKey(code);
  let data = null;
  try{
    data = JSON.parse(localStorage.getItem(key));
  }catch(e){
    data = null;
  }
  if(!data){
    data = {
      name: name || "",
      code,
      classLabel,
      stars: 0,
      lastLogin: null
    };
  }else{
    if(name) data.name = name;
    data.classLabel = classLabel;
    if(typeof data.stars !== "number") data.stars = 0;
  }
  data.lastLogin = todayStr();
  localStorage.setItem(key, JSON.stringify(data));
  return data;
}

function saveCurrent(){
  if(!currentUser) return;
  const key = studentKey(currentUser.code);
  localStorage.setItem(key, JSON.stringify(currentUser));
}

/* ---------- SCREEN SWITCHING ---------- */

function showOnly(id){
  document.getElementById("loginScreen").classList.add("hidden");
  document.getElementById("mainMenuScreen").classList.add("hidden");
  document.getElementById("topicScreen").classList.add("hidden");
  document.getElementById("teacherScreen").classList.add("hidden");
  document.getElementById(id).classList.remove("hidden");
}

function setTopInfo(html){
  document.getElementById("topInfo").innerHTML = html;
}

/* ---------- LOGIN (teacher code 6678) ---------- */

function handleLogin(){
  const name = document.getElementById("loginName").value.trim();
  const codeStr = document.getElementById("loginCode").value.trim();
  const errorEl = document.getElementById("loginError");

  errorEl.classList.add("hidden");
  errorEl.textContent = "";

  if(!codeStr){
    errorEl.textContent = "Enter your code.";
    errorEl.classList.remove("hidden");
    return;
  }

  // TEACHER
  if(codeStr === "6678"){
    currentUser = null;
    setTopInfo(`Logged in as <strong>TEACHER</strong> ¬∑ code 6678`);
    renderTeacherTable();
    showOnly("teacherScreen");
    return;
  }

  const num = Number(codeStr);
  if(!Number.isInteger(num)){
    errorEl.textContent = "Code must be a number.";
    errorEl.classList.remove("hidden");
    return;
  }

  const classLabel = getClassByCode(num);
  if(!classLabel){
    errorEl.textContent = "Unknown student code. Ask your teacher.";
    errorEl.classList.remove("hidden");
    return;
  }

  if(!name){
    errorEl.textContent = "Enter your name.";
    errorEl.classList.remove("hidden");
    return;
  }

  currentUser = loadStudent(num, name, classLabel);
  saveCurrent();

  setTopInfo(
    `Class <strong>${currentUser.classLabel}</strong> ¬∑ Student: <strong>${currentUser.name}</strong> (code ${currentUser.code}) ¬∑ Stars: <strong id="topStars">${currentUser.stars}</strong>`
  );

  buildMainMenu();
  updateTopStars();
  showOnly("mainMenuScreen");
}

function backToLogin(){
  currentUser = null;
  setTopInfo("Not logged in");
  document.getElementById("loginName").value = "";
  document.getElementById("loginCode").value = "";
  showOnly("loginScreen");
}

/* ---------- MAIN MENU UI ---------- */

function buildMainMenu(){
  if(!currentUser) return;

  document.getElementById("menuInfo").innerHTML =
    `Class <strong>${currentUser.classLabel}</strong>, student <strong>${currentUser.name}</strong> (code ${currentUser.code})`;

  document.getElementById("menuStars").textContent = currentUser.stars ?? 0;

  const grid = document.getElementById("menuTopics");
  grid.innerHTML = "";

  topics.forEach(t => {
    const div = document.createElement("div");
    div.className = "topic-card";
    const color = topicColors[t.id] || "#ff6f00";
    div.style.borderColor = color + "66";

    div.innerHTML = `
      <div class="topic-card-title">${t.id}. ${t.title}</div>
      <div class="muted">${t.level}</div>
    `;

    div.addEventListener("click", () => openTopic(t.id));
    grid.appendChild(div);
  });

  const chat = document.getElementById("chatBox");
  chat.innerHTML = "";
  const msg = document.createElement("div");
  msg.className = "chat-msg";
  msg.textContent = "AI Bayan chat will be added later. Now use grammar topics and explanations.";
  chat.appendChild(msg);
  document.getElementById("aiLimit").textContent = "¬∑ demo mode";
}

/* ---------- TOPIC SCREEN ---------- */

function openTopic(id){
  currentTopicId = id;
  const t = topics.find(x => x.id === id);
  if(!t) return;

  const color = topicColors[id] || "#ff6f00";
  document.documentElement.style.setProperty("--topicColor", color);

  document.getElementById("topicHeaderTitle").textContent = `${id}. ${t.title}`;

  const rc = document.getElementById("topicRuleContainer");
  rc.innerHTML = "";

  const gbox = document.createElement("div");
  gbox.className = "grammar-box";
  gbox.innerHTML = `
    <strong>Rule (EN):</strong> ${t.explanation || ""}
    ${
      t.formulas && t.formulas.length
        ? "<div style='margin-top:6px;'>" +
          t.formulas.map(f => `<span class="formula">${f}</span>`).join(" ") +
          "</div>"
        : ""
    }
    ${
      t.ruleRu
        ? `<div style="margin-top:8px;font-size:13px;"><strong>–ü—Ä–∞–≤–∏–ª–æ (RU):</strong><br>${t.ruleRu}</div>`
        : ""
    }
  `;
  rc.appendChild(gbox);

  if(t.examples && t.examples.length){
    const ul = document.createElement("ul");
    ul.className = "examples";
    t.examples.forEach(e => {
      const li = document.createElement("li");
      li.textContent = e;
      ul.appendChild(li);
    });
    rc.appendChild(ul);
  }

  const ec = document.getElementById("topicExercisesContainer");
  ec.innerHTML = "";

  if(!t.exercises || t.exercises.length === 0){
    const p = document.createElement("p");
    p.className = "muted";
    p.style.marginTop = "10px";
    p.textContent = "Exercises for this topic will be added later.";
    ec.appendChild(p);
  }

  const status = document.getElementById("topicStatus");
  status.textContent = "";
  showOnly("topicScreen");
}

function backToMenu(){
  if(!currentUser){
    backToLogin();
    return;
  }
  buildMainMenu();
  showOnly("mainMenuScreen");
}

/* ---------- TEACHER TABLE ---------- */

function renderTeacherTable(){
  const tbody = document.querySelector("#teacherTable tbody");
  tbody.innerHTML = "";

  const allStudents = [];

  classRanges.forEach(r => {
    for(let code = r.from; code <= r.to; code++){
      const key = studentKey(code);
      let data = null;
      try{
        data = JSON.parse(localStorage.getItem(key));
      }catch(e){
        data = null;
      }
      if(data){
        allStudents.push(data);
      }
    }
  });

  if(allStudents.length === 0){
    const tr = document.createElement("tr");
    const td = document.createElement("td");
    td.colSpan = 5;
    td.textContent = "No student data in this browser yet.";
    tr.appendChild(td);
    tbody.appendChild(tr);
    return;
  }

  allStudents.sort((a,b) => a.code - b.code);

  allStudents.forEach(s => {
    const tr = document.createElement("tr");

    const clsTd = document.createElement("td");
    clsTd.textContent = s.classLabel || getClassByCode(s.code) || "";
    const codeTd = document.createElement("td");
    codeTd.textContent = s.code;
    const nameTd = document.createElement("td");
    nameTd.textContent = s.name || "";
    const starsTd = document.createElement("td");
    starsTd.textContent = s.stars ?? 0;
    const loginTd = document.createElement("td");
    loginTd.textContent = s.lastLogin || "";

    tr.appendChild(clsTd);
    tr.appendChild(codeTd);
    tr.appendChild(nameTd);
    tr.appendChild(starsTd);
    tr.appendChild(loginTd);

    tbody.appendChild(tr);
  });
}

/* ---------- STARS DISPLAY ---------- */

function updateTopStars(){
  if(!currentUser) return;
  const topStarsEl = document.getElementById("topStars");
  if(topStarsEl) topStarsEl.textContent = currentUser.stars;

  const menuStarsEl = document.getElementById("menuStars");
  if(menuStarsEl) menuStarsEl.textContent = currentUser.stars;
}

/* ---------- INIT ---------- */

showOnly("loginScreen");
</script>
</body>
</html>
